<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e3a5f">
    <title>ASM DOCS Pro - Gest√£o de Documentos Cl√≠nicos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --azul-marinho: #1e3a5f;
            --dourado: #c9a227;
            --cinza-claro: #f5f5f5;
            --branco: #ffffff;
            --danger: #dc3545;
            --success: #28a745;
            --info: #17a2b8;
            --warning: #ffc107;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--azul-marinho) 0%, #2c4a6e 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* LOGIN SCREEN */
        .login-screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .login-box {
            background: var(--branco);
            border-radius: 20px;
            padding: 40px 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo h2 {
            color: var(--azul-marinho);
            font-size: 2rem;
            margin-bottom: 5px;
        }
        
        .login-logo p {
            color: #666;
            font-size: 0.9rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--azul-marinho);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--dourado);
        }
        
        .btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--dourado) 0%, #b8941f 100%);
            color: var(--azul-marinho);
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:active { transform: scale(0.98); }
        
        .btn-secondary {
            background: var(--azul-marinho);
            color: var(--branco);
            margin-top: 10px;
        }
        
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-info { background: var(--info); color: white; }
        .btn-warning { background: var(--warning); color: #000; }
        .btn-whatsapp { background: #25d366; color: white; }
        
        .btn-sm {
            padding: 10px 20px;
            font-size: 0.9rem;
            width: auto;
        }
        
        .btn-xs {
            padding: 6px 12px;
            font-size: 0.8rem;
            width: auto;
        }
        
        /* MAIN SCREEN */
        .main-screen, .prontuario-screen {
            display: none;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            color: var(--branco);
            margin-bottom: 20px;
            padding: 15px;
            position: relative;
        }
        
        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .header .subtitle {
            font-size: 0.9rem;
            color: var(--dourado);
            font-weight: normal;
        }
        
        .user-info {
            margin-top: 8px;
            font-size: 0.8rem;
            opacity: 0.95;
            border-top: 1px solid rgba(255,255,255,0.2);
            padding-top: 8px;
        }
        
        .back-btn {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        /* NAVIGATION */
        .nav-tabs {
            display: flex;
            background: rgba(255,255,255,0.1);
            overflow-x: auto;
            padding: 10px;
            gap: 10px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .nav-tab {
            flex: 1;
            min-width: 100px;
            padding: 12px 8px;
            background: rgba(255,255,255,0.2);
            border: 2px solid transparent;
            color: white;
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .nav-tab.active {
            background: var(--dourado);
            color: var(--azul-marinho);
        }
        
        /* CONTENT */
        .content-area {
            padding-bottom: 100px;
        }
        
        .section { display: none; }
        .section.active { display: block; }
        
        /* CARDS */
        .form-card {
            background: var(--branco);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }
        
        .form-title {
            color: var(--azul-marinho);
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--dourado);
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .form-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: var(--dourado);
            border-radius: 2px;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            color: var(--azul-marinho);
            margin-bottom: 6px;
            font-size: 0.85rem;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 0.95rem;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--dourado);
            box-shadow: 0 0 0 3px rgba(201, 162, 39, 0.2);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .prof-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .prof-row-3 {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
        }
        
        .prof-row-4 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 10px;
        }
        
        /* PATIENT LIST */
        .patient-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .patient-item {
            background: var(--branco);
            padding: 15px 20px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid var(--dourado);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .patient-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .patient-info h3 {
            color: var(--azul-marinho);
            font-size: 1.1rem;
            margin-bottom: 3px;
        }
        
        .patient-info p {
            color: #666;
            font-size: 0.85rem;
        }
        
        .patient-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .btn-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        .btn-icon:hover {
            transform: scale(1.1);
        }
        
        .btn-edit {
            background: var(--info);
            color: white;
        }
        
        .btn-delete {
            background: var(--danger);
            color: white;
        }
        
        /* DOCUMENT LIST */
        .doc-list {
            display: grid;
            gap: 12px;
        }
        
        .doc-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 4px solid var(--dourado);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .doc-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .doc-name {
            font-weight: 600;
            color: var(--azul-marinho);
        }
        
        /* ESCALA DE DOR - ORIGINAL */
        .escala-dor {
            background: var(--cinza-claro);
            padding: 20px;
            border-radius: 15px;
            margin-top: 10px;
            border-left: 4px solid var(--dourado);
        }
        
        .escala-dor h4 {
            color: var(--azul-marinho);
            margin-bottom: 15px;
            font-size: 0.9rem;
            text-align: center;
        }
        
        .escala-numeros {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .numero-dor {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            font-size: 0.9rem;
        }
        
        .numero-dor.selected {
            background: var(--azul-marinho);
            color: white;
            border-color: var(--azul-marinho);
            transform: scale(1.1);
        }
        
        .numero-dor.dor-leve.selected { background: #4caf50; border-color: #4caf50; }
        .numero-dor.dor-media.selected { background: #ff9800; border-color: #ff9800; }
        .numero-dor.dor-intensa.selected { background: #f44336; border-color: #f44336; }
        
        .escala-linha {
            height: 4px;
            background: linear-gradient(to right, #4caf50 0%, #ff9800 50%, #f44336 100%);
            border-radius: 2px;
            margin: 0 17px;
        }
        
        .escala-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.75rem;
            color: #666;
        }
        
        /* ESTRELA DA DOR - ORIGINAL */
        .estrela-dor-container {
            background: var(--cinza-claro);
            padding: 20px;
            border-radius: 15px;
            margin-top: 10px;
            border-left: 4px solid var(--dourado);
        }
        
        .estrela-dor-container h4 {
            color: var(--azul-marinho);
            margin-bottom: 15px;
            font-size: 0.9rem;
            text-align: center;
        }
        
        .regioes-dor {
            display: grid;
            gap: 15px;
        }
        
        .regiao-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
        }
        
        .regiao-item h5 {
            color: var(--azul-marinho);
            margin-bottom: 15px;
            font-size: 1rem;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--dourado);
        }
        
        .movimentos-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .movimento-item {
            background: var(--cinza-claro);
            padding: 12px;
            border-radius: 10px;
        }
        
        .movimento-item h6 {
            color: #333;
            font-size: 0.85rem;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .movimento-botoes {
            display: flex;
            gap: 5px;
        }
        
        .btn-dor {
            flex: 1;
            padding: 10px 5px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .btn-dor.selected-com-dor {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }
        
        .btn-dor.selected-sem-dor {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }
        
        /* CAPTORES POSTURAIS - ORIGINAL */
        .captores-grid {
            display: grid;
            gap: 12px;
        }
        
        .captor-item {
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
        }
        
        .captor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .captor-nome {
            font-weight: 600;
            color: var(--azul-marinho);
            font-size: 0.95rem;
        }
        
        .captor-botoes {
            display: flex;
            gap: 8px;
        }
        
        .btn-captor {
            padding: 8px 16px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .btn-captor.selected-positivo {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }
        
        .btn-captor.selected-negativo {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }
        
        .captor-obs {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9rem;
            margin-top: 8px;
        }
        
        /* ASSINATURA - ORIGINAL */
        .assinatura-section {
            background: var(--cinza-claro);
            padding: 20px;
            border-radius: 15px;
            margin-top: 15px;
            border-left: 4px solid var(--dourado);
        }
        
        .assinatura-section h4 {
            color: var(--azul-marinho);
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .signature-area {
            background: white;
            border: 2px dashed var(--azul-marinho);
            border-radius: 10px;
            position: relative;
        }
        
        .signature-pad {
            width: 100%;
            height: 150px;
            border-radius: 10px;
            touch-action: none;
            display: block;
        }
        
        .signature-label {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            color: #999;
            font-size: 0.85rem;
            pointer-events: none;
        }
        
        /* CHECKBOX E RADIO GROUPS */
        .checkbox-group, .radio-group {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .checkbox-item, .radio-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 10px 15px;
            border-radius: 20px;
            border: 1px solid #dee2e6;
            cursor: pointer;
        }
        
        .checkbox-item input, .radio-item input {
            width: 20px;
            height: 20px;
            accent-color: var(--azul-marinho);
        }
        
        /* EVOLU√á√ÉO - NOVO MODELO COM 10 CAMPOS EM BRANCO */
        .evolucao-campo {
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            margin-bottom: 15px;
        }
        
        .evolucao-campo h5 {
            color: var(--azul-marinho);
            font-size: 0.95rem;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--dourado);
        }
        
        /* CONTRATO - NOVO ESTILO */
        .clausula-contrato {
            background: var(--cinza-claro);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid var(--dourado);
        }
        
        .clausula-contrato h5 {
            color: var(--azul-marinho);
            font-size: 0.95rem;
            margin-bottom: 10px;
        }
        
        .clausula-contrato p {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #333;
        }
        
        .assinatura-dupla {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .assinatura-box {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }
        
        .assinatura-box h5 {
            color: var(--azul-marinho);
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-align: center;
        }
        
        /* PLANO ALIMENTAR - NUTRI√á√ÉO */
        .refeicao-item {
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            margin-bottom: 10px;
        }
        
        .refeicao-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--dourado);
        }
        
        .refeicao-nome {
            font-weight: 600;
            color: var(--azul-marinho);
            font-size: 1rem;
        }
        
        .refeicao-horario {
            background: var(--dourado);
            color: var(--azul-marinho);
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .alimento-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 8px;
            align-items: center;
        }
        
        .btn-add-alimento {
            background: var(--success);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-top: 10px;
        }
        
        /* ANAMNESE PSICOLOGIA */
        .psico-area {
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            margin-bottom: 15px;
        }
        
        .psico-area h5 {
            color: var(--azul-marinho);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--dourado);
        }
        
        .escala-likert {
            display: flex;
            justify-content: space-between;
            gap: 5px;
            margin-top: 10px;
        }
        
        .likert-item {
            flex: 1;
            text-align: center;
            padding: 10px 5px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.3s;
        }
        
        .likert-item.selected {
            background: var(--azul-marinho);
            color: white;
            border-color: var(--azul-marinho);
        }
        
        /* ANAMNESE M√âDICA */
        .sistema-item {
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            margin-bottom: 10px;
        }
        
        .sistema-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .sistema-nome {
            font-weight: 600;
            color: var(--azul-marinho);
        }
        
        .sistema-status {
            display: flex;
            gap: 5px;
        }
        
        .btn-sistema {
            padding: 5px 15px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 15px;
            font-size: 0.75rem;
            cursor: pointer;
        }
        
        .btn-sistema.selected-normal {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }
        
        .btn-sistema.selected-alterado {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }
        
        /* FONOAUDIOLOGIA */
        .avaliacao-fono-item {
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            margin-bottom: 10px;
        }
        
        .fono-header {
            font-weight: 600;
            color: var(--azul-marinho);
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--dourado);
        }
        
        .fono-escala {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .fono-nivel {
            flex: 1;
            padding: 10px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .fono-nivel.selected-leve { background: #4caf50; color: white; border-color: #4caf50; }
        .fono-nivel.selected-moderado { background: #ff9800; color: white; border-color: #ff9800; }
        .fono-nivel.selected-grave { background: #f44336; color: white; border-color: #f44336; }
        
        /* TERAPIA OCUPACIONAL */
        .avaliacao-to-item {
            background: white;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid #e0e0e0;
            margin-bottom: 10px;
        }
        
        .to-header {
            font-weight: 600;
            color: var(--azul-marinho);
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--dourado);
        }
        
        .to-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .to-item {
            padding: 10px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.75rem;
        }
        
        .to-item.selected-presente { background: #4caf50; color: white; border-color: #4caf50; }
        .to-item.selected-parcial { background: #ff9800; color: white; border-color: #ff9800; }
        .to-item.selected-ausente { background: #f44336; color: white; border-color: #f44336; }
        
        /* BUTTON GROUPS */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .btn-group .btn {
            flex: 1;
            min-width: 140px;
        }
        
        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--cinza-claro);
            padding-bottom: 15px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #999;
        }
        
        /* LOADING */
        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 3000;
            text-align: center;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--dourado);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* TOAST */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #333;
            color: white;
            padding: 15px 30px;
            border-radius: 30px;
            opacity: 0;
            transition: all 0.3s;
            z-index: 9999;
            font-size: 0.9rem;
        }
        
        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        
        /* EMPTY STATE */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        /* PROFESSION BADGE */
        .profession-badge {
            display: inline-block;
            background: var(--dourado);
            color: var(--azul-marinho);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* CONFIGURA√á√ïES - NOVOS CAMPOS */
        .config-section {
            background: var(--cinza-claro);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--dourado);
        }
        
        .config-section h4 {
            color: var(--azul-marinho);
            margin-bottom: 15px;
            font-size: 1rem;
        }
        
        /* CONFIRM DIALOG */
        .confirm-dialog {
            background: white;
            padding: 25px;
            border-radius: 15px;
            max-width: 400px;
            text-align: center;
        }
        
        .confirm-dialog h3 {
            color: var(--azul-marinho);
            margin-bottom: 15px;
        }
        
        .confirm-dialog p {
            margin-bottom: 20px;
            color: #666;
        }
        
        .confirm-dialog .btn-group {
            justify-content: center;
        }
        
        /* RESPONSIVE */
        @media (max-width: 600px) {
            .prof-row, .prof-row-3, .prof-row-4 {
                grid-template-columns: 1fr;
            }
            .movimentos-grid {
                grid-template-columns: 1fr;
            }
            .alimento-row {
                grid-template-columns: 1fr;
            }
            .to-grid {
                grid-template-columns: 1fr;
            }
            .escala-numeros {
                justify-content: center;
            }
            .numero-dor {
                width: 30px;
                height: 30px;
                font-size: 0.8rem;
            }
            .assinatura-dupla {
                grid-template-columns: 1fr;
            }
            .patient-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            .patient-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- TELA DE LOGIN -->
        <div id="loginScreen" class="login-screen">
            <div class="login-box">
                <div class="login-logo">
                    <h2>ASM DOCS</h2>
                    <p>Gest√£o de Documentos Cl√≠nicos Pro</p>
                </div>
                
                <div id="step1">
                    <div class="form-group">
                        <label>CPF do Profissional</label>
                        <input type="text" id="cpfInput" placeholder="000.000.000-00" maxlength="14">
                    </div>
                    
                    <div class="form-group">
                        <label>C√≥digo de Ativa√ß√£o</label>
                        <input type="text" id="codeInput" placeholder="ASM######" maxlength="9">
                    </div>
                    
                    <button class="btn" onclick="validateCode()">Continuar</button>
                </div>
                
                <div id="step2" style="display:none;">
                    <div class="form-group">
                        <label>Selecione sua Profiss√£o</label>
                        <select id="professionSelect">
                            <option value="">Escolha...</option>
                            <option value="fisioterapia">Fisioterapia</option>
                            <option value="nutricao">Nutri√ß√£o</option>
                            <option value="psicologia">Psicologia</option>
                            <option value="medicina">Medicina</option>
                            <option value="fonoaudiologia">Fonoaudiologia</option>
                            <option value="terapiaocupacional">Terapia Ocupacional</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Nome Completo</label>
                        <input type="text" id="nameInput" placeholder="Dr(a). Nome Completo">
                    </div>
                    
                    <div class="form-group">
                        <label>Registro Profissional</label>
                        <input type="text" id="registroInput" placeholder="CREFITO/CRN/CRM/CRP...">
                    </div>
                    
                    <div class="form-group">
                        <label>E-mail Profissional</label>
                        <input type="email" id="emailInput" placeholder="seu@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label>WhatsApp Profissional</label>
                        <input type="text" id="whatsappInput" placeholder="(00) 00000-0000" maxlength="15">
                    </div>
                    
                    <div class="form-group">
                        <label>Nome da Cl√≠nica/Empresa (opcional)</label>
                        <input type="text" id="clinicaInput" placeholder="Nome da sua cl√≠nica">
                    </div>
                    
                    <button class="btn" onclick="completeRegistration()">Acessar Sistema</button>
                    <button class="btn btn-secondary" onclick="backToStep1()">Voltar</button>
                </div>
            </div>
        </div>
        
        <!-- TELA PRINCIPAL -->
        <div id="mainScreen" class="main-screen">
            <div class="header">
                <h1>ASM DOCS Pro</h1>
                <div class="subtitle">Gest√£o de Documentos Cl√≠nicos</div>
                <div class="user-info" id="userDisplay"></div>
            </div>
            
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showSection('patients')">Pacientes</button>
                <button class="nav-tab" onclick="showSection('documents')">Novo Doc</button>
                <button class="nav-tab" onclick="showSection('history')">Hist√≥rico</button>
                <button class="nav-tab" onclick="showSection('settings')">Config</button>
            </div>
            
            <div class="content-area">
                <!-- SE√á√ÉO PACIENTES -->
                <div id="patientsSection" class="section active">
                    <div class="form-title">
                        <span>Meus Pacientes</span>
                        <button class="btn btn-sm btn-success" onclick="openNewPatientModal()">+ Novo Paciente</button>
                    </div>
                    <div id="patientsList" class="patient-list"></div>
                </div>
                
                <!-- SE√á√ÉO DOCUMENTOS -->
                <div id="documentsSection" class="section">
                    <div class="form-title">Criar Novo Documento</div>
                    <div class="form-card">
                        <div class="form-group">
                            <label>Selecione o Paciente</label>
                            <select id="docPatientSelect" class="form-select" onchange="updatePatientForDoc()">
                                <option value="">Escolha um paciente...</option>
                            </select>
                        </div>
                    </div>
                    <div id="documentsList" class="doc-list"></div>
                </div>
                
                <!-- SE√á√ÉO HIST√ìRICO -->
                <div id="historySection" class="section">
                    <div class="form-title">Todos os Documentos</div>
                    <div id="allDocumentsList"></div>
                </div>
                
                <!-- SE√á√ÉO CONFIGURA√á√ïES -->
                <div id="settingsSection" class="section">
                    <div class="form-title">Configura√ß√µes</div>
                    <div class="form-card">
                        <h3 style="color:var(--azul-marinho);margin-bottom:15px;">Informa√ß√µes do Profissional</h3>
                        <div id="professionalInfo"></div>
                        
                        <div class="config-section" style="margin-top:20px;">
                            <h4>üìã Dados do Cabe√ßalho dos PDFs</h4>
                            <div class="form-group">
                                <label>Nome da Cl√≠nica/Empresa</label>
                                <input type="text" id="configClinica" class="form-input" placeholder="Nome que aparecer√° nos PDFs">
                            </div>
                            <div class="form-group">
                                <label>Endere√ßo da Cl√≠nica</label>
                                <input type="text" id="configEndereco" class="form-input" placeholder="Endere√ßo completo">
                            </div>
                            <div class="form-group">
                                <label>Telefone da Cl√≠nica</label>
                                <input type="text" id="configTelefone" class="form-input" placeholder="(00) 0000-0000">
                            </div>
                            <button class="btn btn-success btn-sm" onclick="saveConfig()" style="width:auto;">üíæ Salvar Configura√ß√µes</button>
                        </div>
                        
                        <button class="btn btn-danger" onclick="logout()" style="margin-top:20px;">Sair do Sistema</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TELA DE PRONTU√ÅRIO -->
        <div id="prontuarioScreen" class="prontuario-screen">
            <div class="header">
                <button class="back-btn" onclick="closeProntuario()">‚Üê Voltar</button>
                <h1>Prontu√°rio</h1>
                <div class="subtitle">Ficha do Paciente</div>
            </div>
            
            <div class="content-area">
                <div class="form-card">
                    <h2 id="prontuarioPatientName" style="color:var(--azul-marinho);margin-bottom:15px;">Nome do Paciente</h2>
                    <div id="prontuarioPatientData" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;font-size:0.9rem;color:#666;"></div>
                    
                    <div class="btn-group" style="margin-top:20px;">
                        <button class="btn btn-success" onclick="openNewDocumentForPatient()">üìù Novo Documento</button>
                        <button class="btn btn-info" onclick="exportProntuarioPDF()">üìÑ Exportar Prontu√°rio</button>
                        <button class="btn btn-whatsapp" onclick="contactPatient()">üì± Contato</button>
                        <button class="btn btn-warning" onclick="editPatientFromProntuario()">‚úèÔ∏è Editar Paciente</button>
                    </div>
                </div>
                
                <div class="form-title">Hist√≥rico de Documentos</div>
                <div id="patientDocumentsList"></div>
            </div>
        </div>
        
        <!-- MODAL DE NOVO PACIENTE -->
        <div id="newPatientModal" class="modal" onclick="if(event.target===this)closeNewPatientModal()">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="newPatientModalTitle">Cadastrar Novo Paciente</h3>
                    <button class="close-btn" onclick="closeNewPatientModal()">&times;</button>
                </div>
                <input type="hidden" id="editPatientId">
                <div class="form-group">
                    <label>Nome Completo *</label>
                    <input type="text" id="newPatientName" class="form-input" placeholder="Nome do paciente">
                </div>
                <div class="prof-row">
                    <div class="form-group">
                        <label>Data de Nascimento</label>
                        <input type="date" id="newPatientBirth" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>CPF</label>
                        <input type="text" id="newPatientCPF" class="form-input" placeholder="000.000.000-00">
                    </div>
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="text" id="newPatientPhone" class="form-input" placeholder="(00) 00000-0000">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="newPatientEmail" class="form-input" placeholder="email@exemplo.com">
                </div>
                <div class="form-group">
                    <label>Endere√ßo</label>
                    <input type="text" id="newPatientAddress" class="form-input" placeholder="Rua, n√∫mero, bairro">
                </div>
                <div class="form-group">
                    <label>Conv√™nio/Plano de Sa√∫de</label>
                    <input type="text" id="newPatientConvenio" class="form-input" placeholder="Nome do conv√™nio (opcional)">
                </div>
                <button class="btn" id="savePatientBtn" onclick="saveNewPatient()">Salvar Paciente</button>
            </div>
        </div>
        
        <!-- MODAL DE CONFIRMA√á√ÉO DE EXCLUS√ÉO -->
        <div id="confirmDeleteModal" class="modal" onclick="if(event.target===this)closeConfirmDeleteModal()">
            <div class="confirm-dialog">
                <h3>‚ö†Ô∏è Confirmar Exclus√£o</h3>
                <p id="confirmDeleteText">Tem certeza que deseja excluir este paciente?</p>
                <div class="btn-group">
                    <button class="btn btn-danger" onclick="confirmDeletePatient()">Sim, Excluir</button>
                    <button class="btn btn-secondary" onclick="closeConfirmDeleteModal()">Cancelar</button>
                </div>
            </div>
        </div>
        
        <!-- MODAL DE DOCUMENTO -->
        <div id="documentModal" class="modal" onclick="if(event.target===this)closeDocumentModal()">
            <div class="modal-content" style="max-width:900px;">
                <div class="modal-header">
                    <h3 id="modalTitle">Novo Documento</h3>
                    <button class="close-btn" onclick="closeDocumentModal()">&times;</button>
                </div>
                <div id="modalBody"></div>
            </div>
        </div>
        
        <!-- MODAL DE VISUALIZA√á√ÉO -->
        <div id="viewModal" class="modal" onclick="if(event.target===this)closeViewModal()">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="viewModalTitle">Visualizar Documento</h3>
                    <button class="close-btn" onclick="closeViewModal()">&times;</button>
                </div>
                <div id="viewModalBody" style="max-height:60vh;overflow-y:auto;"></div>
                <div class="btn-group" style="margin-top:20px;">
                    <button class="btn btn-danger" onclick="generatePDFFromView()">üìÑ Baixar PDF</button>
                    <button class="btn btn-whatsapp" onclick="sendWhatsAppFromView()">üì± WhatsApp</button>
                </div>
            </div>
        </div>
        
        <!-- LOADING -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Processando...</p>
        </div>
        
        <!-- TOAST -->
        <div id="toast" class="toast"></div>
    </div>

<script>
// ============================================================
// FIREBASE CONFIG
// ============================================================
const firebaseConfig = {
    apiKey: "AIzaSyCahe3sNMGAzG-QM-q-IOkCyGF_HDl8oOE",
    authDomain: "asm-docs-universal.firebaseapp.com",
    databaseURL: "https://asm-docs-universal-default-rtdb.firebaseio.com",
    projectId: "asm-docs-universal",
    storageBucket: "asm-docs-universal.firebasestorage.app",
    messagingSenderId: "39021662623",
    appId: "1:39021662623:web:ec6399c46255cd5a13adaa"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// VARI√ÅVEIS GLOBAIS
let currentUser = null;
let currentProfession = null;
let currentPatientId = null;
let currentPatientData = null;
let currentViewDoc = null;
let currentDocType = null;
let nivelDorSelecionado = null;
let assinaturas = {};
let userConfig = {};
let patientToDelete = null;

// PROFISS√ïES E DOCUMENTOS
const professions = {
    fisioterapia: {
        name: "Fisioterapia",
        registro: "CREFITO",
        documents: [
            { id: 'anamnese', name: 'Anamnese Fisioterap√™utica', icon: 'üìã' },
            { id: 'avaliacao', name: 'Avalia√ß√£o Fisioterap√™utica Completa', icon: 'üè•' },
            { id: 'evolucao', name: 'Evolu√ß√£o', icon: 'üìà' },
            { id: 'contrato', name: 'Contrato de Presta√ß√£o de Servi√ßos', icon: 'üìù' },
            { id: 'alta', name: 'Alta Fisioterap√™utica', icon: '‚úÖ' },
            { id: 'atestado', name: 'Atestado', icon: 'üìÑ' },
            { id: 'tcle', name: 'TCLE - Consentimento', icon: 'üìë' },
            { id: 'comparecimento', name: 'Declara√ß√£o de Comparecimento', icon: 'üïê' },
            { id: 'reembolso', name: 'Relat√≥rio para Reembolso', icon: 'üí∞' },
            { id: 'encaminhamento', name: 'Encaminhamento', icon: '‚û°Ô∏è' }
        ]
    },
    nutricao: {
        name: "Nutri√ß√£o",
        registro: "CRN",
        documents: [
            { id: 'anamnese', name: 'Anamnese Nutricional Completa', icon: 'üìã' },
            { id: 'avaliacao', name: 'Avalia√ß√£o Antropom√©trica e Cl√≠nica', icon: 'üìè' },
            { id: 'plano', name: 'Plano Alimentar Individualizado', icon: 'üçΩÔ∏è' },
            { id: 'evolucao', name: 'Evolu√ß√£o Nutricional', icon: 'üìä' },
            { id: 'contrato', name: 'Contrato de Presta√ß√£o de Servi√ßos', icon: 'üìù' },
            { id: 'alta', name: 'Alta Nutricional', icon: '‚úÖ' },
            { id: 'atestado', name: 'Atestado', icon: 'üìÑ' }
        ]
    },
    psicologia: {
        name: "Psicologia",
        registro: "CRP",
        documents: [
            { id: 'anamnese', name: 'Anamnese Psicossocial Completa', icon: 'üß†' },
            { id: 'avaliacao', name: 'Avalia√ß√£o Psicol√≥gica', icon: 'üéØ' },
            { id: 'evolucao', name: 'Evolu√ß√£o Psicoter√°pica', icon: 'üìà' },
            { id: 'contrato', name: 'Contrato de Presta√ß√£o de Servi√ßos', icon: 'üìù' },
            { id: 'relatorio', name: 'Relat√≥rio Psicol√≥gico', icon: 'üìÑ' },
            { id: 'alta', name: 'Alta Psicol√≥gica', icon: '‚úÖ' },
            { id: 'atestado', name: 'Atestado', icon: 'üìã' }
        ]
    },
    medicina: {
        name: "Medicina",
        registro: "CRM",
        documents: [
            { id: 'anamnese', name: 'Anamnese Cl√≠nica Completa', icon: 'ü©∫' },
            { id: 'avaliacao', name: 'Exame F√≠sico Completo', icon: 'üîç' },
            { id: 'evolucao', name: 'Evolu√ß√£o M√©dica', icon: 'üìà' },
            { id: 'contrato', name: 'Contrato de Presta√ß√£o de Servi√ßos', icon: 'üìù' },
            { id: 'receituario', name: 'Receitu√°rio', icon: 'üíä' },
            { id: 'alta', name: 'Alta M√©dica', icon: '‚úÖ' },
            { id: 'atestado', name: 'Atestado M√©dico', icon: 'üìÑ' },
            { id: 'relatorio', name: 'Relat√≥rio M√©dico', icon: 'üìã' }
        ]
    },
    fonoaudiologia: {
        name: "Fonoaudiologia",
        registro: "CREFONO",
        documents: [
            { id: 'anamnese', name: 'Anamnese Fonoaudiol√≥gica', icon: 'üëÇ' },
            { id: 'avaliacao', name: 'Avalia√ß√£o Fonoaudiol√≥gica Completa', icon: 'üé§' },
            { id: 'evolucao', name: 'Evolu√ß√£o Terap√™utica', icon: 'üìà' },
            { id: 'contrato', name: 'Contrato de Presta√ß√£o de Servi√ßos', icon: 'üìù' },
            { id: 'relatorio', name: 'Relat√≥rio T√©cnico', icon: 'üìÑ' },
            { id: 'alta', name: 'Alta Fonoaudiol√≥gica', icon: '‚úÖ' },
            { id: 'atestado', name: 'Atestado', icon: 'üìã' }
        ]
    },
    terapiaocupacional: {
        name: "Terapia Ocupacional",
        registro: "CREFITO",
        documents: [
            { id: 'anamnese', name: 'Anamnese em Terapia Ocupacional', icon: 'üèÉ' },
            { id: 'avaliacao', name: 'Avalia√ß√£o Funcional Completa', icon: 'üéØ' },
            { id: 'evolucao', name: 'Evolu√ß√£o Terap√™utica', icon: 'üìà' },
            { id: 'contrato', name: 'Contrato de Presta√ß√£o de Servi√ßos', icon: 'üìù' },
            { id: 'relatorio', name: 'Relat√≥rio de Avalia√ß√£o', icon: 'üìÑ' },
            { id: 'alta', name: 'Alta em Terapia Ocupacional', icon: '‚úÖ' },
            { id: 'atestado', name: 'Atestado', icon: 'üìã' }
        ]
    }
};

// M√ÅSCARAS
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('cpfInput')?.addEventListener('input', maskCPF);
    document.getElementById('newPatientCPF')?.addEventListener('input', maskCPF);
    document.getElementById('newPatientPhone')?.addEventListener('input', maskPhone);
    document.getElementById('whatsappInput')?.addEventListener('input', maskPhone);
    
    // Inicializar datas
    document.querySelectorAll('input[type="date"]').forEach(input => {
        if (!input.value) input.valueAsDate = new Date();
    });
    
    // Verificar login salvo
    const savedUser = localStorage.getItem('asmDocsUser');
    if (savedUser) {
        currentUser = JSON.parse(savedUser);
        currentProfession = professions[currentUser.profession];
        loadUserConfig();
    }
});

function maskCPF(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length <= 11) {
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
        e.target.value = value;
    }
}

function maskPhone(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length <= 11) {
        if (value.length > 10) {
            value = value.replace(/^(\d{2})(\d{5})(\d{4})$/, '($1) $2-$3');
        } else if (value.length > 6) {
            value = value.replace(/^(\d{2})(\d{4})(\d{0,4})$/, '($1) $2-$3');
        } else if (value.length > 2) {
            value = value.replace(/^(\d{2})(\d{0,5})$/, '($1) $2');
        }
        e.target.value = value;
    }
}

// LOGIN
function validateCode() {
    const cpf = document.getElementById('cpfInput').value.replace(/\D/g, '');
    const code = document.getElementById('codeInput').value.toUpperCase();
    
    if (cpf.length !== 11) {
        showToast('CPF inv√°lido!');
        return;
    }
    
    if (!code.match(/^ASM\d{6}$/)) {
        showToast('C√≥digo deve come√ßar com ASM seguido de 6 n√∫meros!');
        return;
    }
    
    showLoading(true);
    
    database.ref('activationCodes/' + code).once('value')
        .then(snapshot => {
            showLoading(false);
            if (snapshot.exists()) {
                const codeData = snapshot.val();
                
                if (codeData.used && codeData.cpf && codeData.cpf !== cpf) {
                    showToast('C√≥digo j√° utilizado em outro CPF!');
                    return;
                }
                
                document.getElementById('step1').style.display = 'none';
                document.getElementById('step2').style.display = 'block';
                
                if (codeData.profession) {
                    document.getElementById('professionSelect').value = codeData.profession;
                    document.getElementById('nameInput').value = codeData.name || '';
                    document.getElementById('registroInput').value = codeData.registro || '';
                    document.getElementById('emailInput').value = codeData.email || '';
                    document.getElementById('whatsappInput').value = codeData.whatsapp || '';
                    document.getElementById('clinicaInput').value = codeData.clinica || '';
                }
            } else {
                showToast('C√≥digo n√£o encontrado no sistema!');
            }
        })
        .catch(error => {
            showLoading(false);
            showToast('Erro ao verificar c√≥digo: ' + error.message);
        });
}

function backToStep1() {
    document.getElementById('step2').style.display = 'none';
    document.getElementById('step1').style.display = 'block';
}

function completeRegistration() {
    const profession = document.getElementById('professionSelect').value;
    const name = document.getElementById('nameInput').value.trim();
    const registro = document.getElementById('registroInput').value.trim();
    const email = document.getElementById('emailInput').value.trim();
    const whatsapp = document.getElementById('whatsappInput').value.trim();
    const clinica = document.getElementById('clinicaInput').value.trim();
    const cpf = document.getElementById('cpfInput').value.replace(/\D/g, '');
    const code = document.getElementById('codeInput').value.toUpperCase();
    
    if (!profession || !name || !registro || !email || !whatsapp) {
        showToast('Preencha todos os campos obrigat√≥rios!');
        return;
    }
    
    showLoading(true);
    
    const userData = {
        cpf: cpf,
        code: code,
        profession: profession,
        name: name,
        registro: registro,
        email: email,
        whatsapp: whatsapp,
        clinica: clinica,
        createdAt: new Date().toISOString()
    };
    
    const updates = {};
    updates['activationCodes/' + code + '/used'] = true;
    updates['activationCodes/' + code + '/cpf'] = cpf;
    updates['activationCodes/' + code + '/profession'] = profession;
    updates['activationCodes/' + code + '/name'] = name;
    updates['activationCodes/' + code + '/registro'] = registro;
    updates['activationCodes/' + code + '/email'] = email;
    updates['activationCodes/' + code + '/whatsapp'] = whatsapp;
    updates['activationCodes/' + code + '/clinica'] = clinica;
    updates['activationCodes/' + code + '/activatedAt'] = new Date().toISOString();
    updates['users/' + cpf] = userData;
    
    database.ref().update(updates)
        .then(() => {
            showLoading(false);
            currentUser = userData;
            currentProfession = professions[profession];
            localStorage.setItem('asmDocsUser', JSON.stringify(userData));
            startApp();
        })
        .catch(error => {
            showLoading(false);
            showToast('Erro ao salvar: ' + error.message);
        });
}

function startApp() {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('mainScreen').style.display = 'block';
    
    const profBadge = `<span class="profession-badge">${currentProfession.name}</span>`;
    document.getElementById('userDisplay').innerHTML = `
        ${profBadge}<br>
        <strong>${currentUser.name}</strong><br>
        ${currentUser.registro}
    `;
    
    updateProfessionalInfo();
    loadUserConfig();
    loadPatients();
    loadAllDocuments();
}

function updateProfessionalInfo() {
    const clinicaDisplay = currentUser.clinica ? `<p><strong>Cl√≠nica:</strong> ${currentUser.clinica}</p>` : '';
    
    document.getElementById('professionalInfo').innerHTML = `
        <p><strong>Nome:</strong> ${currentUser.name}</p>
        <p><strong>Profiss√£o:</strong> ${currentProfession.name}</p>
        <p><strong>Registro:</strong> ${currentUser.registro}</p>
        <p><strong>CPF:</strong> ${currentUser.cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4')}</p>
        <p><strong>E-mail:</strong> ${currentUser.email}</p>
        <p><strong>WhatsApp:</strong> ${currentUser.whatsapp}</p>
        ${clinicaDisplay}
        <p><strong>C√≥digo:</strong> ${currentUser.code}</p>
    `;
}

function loadUserConfig() {
    if (!currentUser) return;
    
    database.ref('userConfig/' + currentUser.cpf).once('value')
        .then(snapshot => {
            if (snapshot.exists()) {
                userConfig = snapshot.val();
                document.getElementById('configClinica').value = userConfig.clinica || currentUser.clinica || '';
                document.getElementById('configEndereco').value = userConfig.endereco || '';
                document.getElementById('configTelefone').value = userConfig.telefone || currentUser.whatsapp || '';
            } else {
                document.getElementById('configClinica').value = currentUser.clinica || '';
                document.getElementById('configTelefone').value = currentUser.whatsapp || '';
            }
        });
}

function saveConfig() {
    const config = {
        clinica: document.getElementById('configClinica').value.trim(),
        endereco: document.getElementById('configEndereco').value.trim(),
        telefone: document.getElementById('configTelefone').value.trim(),
        updatedAt: new Date().toISOString()
    };
    
    showLoading(true);
    database.ref('userConfig/' + currentUser.cpf).set(config)
        .then(() => {
            showLoading(false);
            userConfig = config;
            showToast('Configura√ß√µes salvas!');
        })
        .catch(error => {
            showLoading(false);
            showToast('Erro ao salvar: ' + error.message);
        });
}

function logout() {
    if (confirm('Deseja realmente sair?')) {
        localStorage.removeItem('asmDocsUser');
        location.reload();
    }
}

// PACIENTES - COM OP√á√ïES DE EDITAR E EXCLUIR
function loadPatients() {
    const container = document.getElementById('patientsList');
    const select = document.getElementById('docPatientSelect');
    
    container.innerHTML = '<p style="text-align:center;color:#666;padding:20px;">Carregando...</p>';
    if (select) select.innerHTML = '<option value="">Escolha um paciente...</option>';
    
    database.ref('patients/' + currentUser.cpf).orderByChild('name').once('value')
        .then(snapshot => {
            container.innerHTML = '';
            
            if (!snapshot.exists()) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üë•</div>
                        <p>Nenhum paciente cadastrado</p>
                        <p style="font-size:0.9rem;margin-top:10px;">Clique em "Novo Paciente" para come√ßar</p>
                    </div>
                `;
                return;
            }
            
            snapshot.forEach(child => {
                const patient = child.val();
                const patientId = child.key;
                
                if (select) {
                    const option = document.createElement('option');
                    option.value = patientId;
                    option.textContent = patient.name;
                    select.appendChild(option);
                }
                
                const div = document.createElement('div');
                div.className = 'patient-item';
                
                const age = patient.birth ? calculateAge(patient.birth) : '';
                
                div.innerHTML = `
                    <div class="patient-info" onclick="openProntuario('${patientId}', ${JSON.stringify(patient).replace(/"/g, '&quot;')})">
                        <h3>${patient.name}</h3>
                        <p>${age ? age + ' anos' : ''} ${patient.phone ? '‚Ä¢ ' + patient.phone : ''}</p>
                    </div>
                    <div class="patient-actions" onclick="event.stopPropagation()">
                        <button class="btn-icon btn-edit" onclick="openEditPatientModal('${patientId}', ${JSON.stringify(patient).replace(/"/g, '&quot;')})" title="Editar paciente">‚úèÔ∏è</button>
                        <button class="btn-icon btn-delete" onclick="confirmDeletePatientModal('${patientId}', '${patient.name}')" title="Excluir paciente">üóëÔ∏è</button>
                        <div style="color:var(--dourado);font-size:1.5rem;margin-left:5px;">‚Ä∫</div>
                    </div>
                `;
                
                container.appendChild(div);
            });
        });
}

function calculateAge(birthDate) {
    const today = new Date();
    const birth = new Date(birthDate);
    let age = today.getFullYear() - birth.getFullYear();
    const monthDiff = today.getMonth() - birth.getMonth();
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
        age--;
    }
    return age;
}

// PRONTU√ÅRIO
function openProntuario(patientId, patientData) {
    currentPatientId = patientId;
    currentPatientData = patientData;
    
    document.getElementById('mainScreen').style.display = 'none';
    document.getElementById('prontuarioScreen').style.display = 'block';
    
    document.getElementById('prontuarioPatientName').textContent = patientData.name;
    
    const age = patientData.birth ? calculateAge(patientData.birth) : '-';
    const cpfFormatted = patientData.cpf ? patientData.cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4') : '-';
    
    document.getElementById('prontuarioPatientData').innerHTML = `
        <span><strong>Idade:</strong> ${age} anos</span>
        <span><strong>CPF:</strong> ${cpfFormatted}</span>
        <span><strong>Telefone:</strong> ${patientData.phone || '-'}</span>
        <span><strong>Email:</strong> ${patientData.email || '-'}</span>
        <span><strong>Endere√ßo:</strong> ${patientData.address || '-'}</span>
        <span><strong>Conv√™nio:</strong> ${patientData.convenio || '-'}</span>
    `;
    
    loadPatientDocuments(patientId);
}

function closeProntuario() {
    document.getElementById('prontuarioScreen').style.display = 'none';
    document.getElementById('mainScreen').style.display = 'block';
    currentPatientId = null;
    currentPatientData = null;
}

function loadPatientDocuments(patientId) {
    const container = document.getElementById('patientDocumentsList');
    container.innerHTML = '<p style="text-align:center;color:#666;padding:20px;">Carregando...</p>';
    
    database.ref('documents/' + currentUser.cpf).orderByChild('patientId').equalTo(patientId).once('value')
        .then(snapshot => {
            container.innerHTML = '';
            
            if (!snapshot.exists()) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <p>Nenhum documento encontrado</p>
                    </div>
                `;
                return;
            }
            
            const docs = [];
            snapshot.forEach(child => {
                const doc = child.val();
                doc.id = child.key;
                docs.push(doc);
            });
            
            docs.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            docs.forEach(doc => {
                const div = document.createElement('div');
                div.className = 'form-card';
                div.style.cursor = 'pointer';
                div.onclick = () => viewDocument(doc.id);
                
                const docDate = new Date(doc.date).toLocaleDateString('pt-BR');
                
                div.innerHTML = `
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <div>
                            <h4 style="color:var(--azul-marinho);">${doc.docName || doc.type}</h4>
                            <p style="color:#666;font-size:0.85rem;">${docDate} ‚Ä¢ ${doc.professional}</p>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-info" onclick="event.stopPropagation();viewDocument('${doc.id}')" style="margin-right:5px;">üëÅ</button>
                            <button class="btn btn-sm btn-danger" onclick="event.stopPropagation();generatePDFSingle('${doc.id}')">üìÑ</button>
                        </div>
                    </div>
                `;
                
                container.appendChild(div);
            });
        });
}

// NOVO PACIENTE / EDITAR PACIENTE
function openNewPatientModal() {
    // Resetar formul√°rio para novo paciente
    document.getElementById('newPatientModalTitle').textContent = 'Cadastrar Novo Paciente';
    document.getElementById('editPatientId').value = '';
    document.getElementById('savePatientBtn').textContent = 'Salvar Paciente';
    document.getElementById('savePatientBtn').onclick = saveNewPatient;
    
    // Limpar campos
    document.getElementById('newPatientName').value = '';
    document.getElementById('newPatientBirth').value = '';
    document.getElementById('newPatientCPF').value = '';
    document.getElementById('newPatientPhone').value = '';
    document.getElementById('newPatientEmail').value = '';
    document.getElementById('newPatientAddress').value = '';
    document.getElementById('newPatientConvenio').value = '';
    
    document.getElementById('newPatientModal').style.display = 'flex';
}

function openEditPatientModal(patientId, patientData) {
    // Configurar formul√°rio para edi√ß√£o
    document.getElementById('newPatientModalTitle').textContent = 'Editar Paciente';
    document.getElementById('editPatientId').value = patientId;
    document.getElementById('savePatientBtn').textContent = 'Atualizar Paciente';
    document.getElementById('savePatientBtn').onclick = updatePatient;
    
    // Preencher campos com dados existentes
    document.getElementById('newPatientName').value = patientData.name || '';
    document.getElementById('newPatientBirth').value = patientData.birth || '';
    document.getElementById('newPatientCPF').value = patientData.cpf || '';
    document.getElementById('newPatientPhone').value = patientData.phone || '';
    document.getElementById('newPatientEmail').value = patientData.email || '';
    document.getElementById('newPatientAddress').value = patientData.address || '';
    document.getElementById('newPatientConvenio').value = patientData.convenio || '';
    
    document.getElementById('newPatientModal').style.display = 'flex';
}

function closeNewPatientModal() {
    document.getElementById('newPatientModal').style.display = 'none';
}

function saveNewPatient() {
    const name = document.getElementById('newPatientName').value.trim();
    const birth = document.getElementById('newPatientBirth').value;
    const cpf = document.getElementById('newPatientCPF').value.replace(/\D/g, '');
    const phone = document.getElementById('newPatientPhone').value;
    const email = document.getElementById('newPatientEmail').value.trim();
    const address = document.getElementById('newPatientAddress').value.trim();
    const convenio = document.getElementById('newPatientConvenio').value.trim();
    
    if (!name) {
        showToast('Digite o nome do paciente!');
        return;
    }
    
    showLoading(true);
    
    const patientData = {
        name: name,
        birth: birth,
        cpf: cpf,
        phone: phone,
        email: email,
        address: address,
        convenio: convenio,
        createdAt: new Date().toISOString(),
        professionalCpf: currentUser.cpf
    };
    
    const patientRef = database.ref('patients/' + currentUser.cpf).push();
    patientRef.set(patientData)
        .then(() => {
            showLoading(false);
            showToast('Paciente salvo com sucesso!');
            closeNewPatientModal();
            loadPatients();
        })
        .catch(error => {
            showLoading(false);
            showToast('Erro ao salvar: ' + error.message);
        });
}

function updatePatient() {
    const patientId = document.getElementById('editPatientId').value;
    if (!patientId) {
        showToast('Erro: ID do paciente n√£o encontrado!');
        return;
    }
    
    const name = document.getElementById('newPatientName').value.trim();
    const birth = document.getElementById('newPatientBirth').value;
    const cpf = document.getElementById('newPatientCPF').value.replace(/\D/g, '');
    const phone = document.getElementById('newPatientPhone').value;
    const email = document.getElementById('newPatientEmail').value.trim();
    const address = document.getElementById('newPatientAddress').value.trim();
    const convenio = document.getElementById('newPatientConvenio').value.trim();
    
    if (!name) {
        showToast('Digite o nome do paciente!');
        return;
    }
    
    showLoading(true);
    
    const patientData = {
        name: name,
        birth: birth,
        cpf: cpf,
        phone: phone,
        email: email,
        address: address,
        convenio: convenio,
        updatedAt: new Date().toISOString(),
        professionalCpf: currentUser.cpf
    };
    
    database.ref('patients/' + currentUser.cpf + '/' + patientId).update(patientData)
        .then(() => {
            showLoading(false);
            showToast('Paciente atualizado com sucesso!');
            closeNewPatientModal();
            loadPatients();
            
            // Se estiver no prontu√°rio deste paciente, atualizar os dados
            if (currentPatientId === patientId) {
                currentPatientData = patientData;
                openProntuario(patientId, patientData);
            }
        })
        .catch(error => {
            showLoading(false);
            showToast('Erro ao atualizar: ' + error.message);
        });
}

// EXCLUIR PACIENTE
function confirmDeletePatientModal(patientId, patientName) {
    patientToDelete = patientId;
    document.getElementById('confirmDeleteText').textContent = `Tem certeza que deseja excluir o paciente "${patientName}"? Esta a√ß√£o n√£o pode ser desfeita.`;
    document.getElementById('confirmDeleteModal').style.display = 'flex';
}

function closeConfirmDeleteModal() {
    document.getElementById('confirmDeleteModal').style.display = 'none';
    patientToDelete = null;
}

function confirmDeletePatient() {
    if (!patientToDelete) return;
    
    showLoading(true);
    
    // Primeiro excluir todos os documentos do paciente
    database.ref('documents/' + currentUser.cpf).orderByChild('patientId').equalTo(patientToDelete).once('value')
        .then(snapshot => {
            const updates = {};
            
            // Adicionar exclus√£o de documentos
            snapshot.forEach(child => {
                updates['documents/' + currentUser.cpf + '/' + child.key] = null;
            });
            
            // Adicionar exclus√£o do paciente
            updates['patients/' + currentUser.cpf + '/' + patientToDelete] = null;
            
            return database.ref().update(updates);
        })
        .then(() => {
            showLoading(false);
            showToast('Paciente exclu√≠do com sucesso!');
            closeConfirmDeleteModal();
            loadPatients();
            
            // Se estiver no prontu√°rio deste paciente, voltar para lista
            if (currentPatientId === patientToDelete) {
                closeProntuario();
            }
        })
        .catch(error => {
            showLoading(false);
            showToast('Erro ao excluir: ' + error.message);
            closeConfirmDeleteModal();
        });
}

// Editar paciente a partir do prontu√°rio
function editPatientFromProntuario() {
    if (currentPatientId && currentPatientData) {
        openEditPatientModal(currentPatientId, currentPatientData);
    }
}

// NAVEGA√á√ÉO
function showSection(sectionName) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
    
    document.getElementById(sectionName + 'Section').classList.add('active');
    
    const tabs = document.querySelectorAll('.nav-tab');
    const sectionIndex = ['patients', 'documents', 'history', 'settings'].indexOf(sectionName);
    if (tabs[sectionIndex]) tabs[sectionIndex].classList.add('active');
    
    if (sectionName === 'documents') {
        loadDocumentsList();
    } else if (sectionName === 'history') {
        loadAllDocuments();
    }
}

function updatePatientForDoc() {
    const patientId = document.getElementById('docPatientSelect').value;
    if (patientId) {
        loadDocumentsList();
    } else {
        document.getElementById('documentsList').innerHTML = '';
    }
}

function loadDocumentsList() {
    const container = document.getElementById('documentsList');
    container.innerHTML = '';
    
    currentProfession.documents.forEach(doc => {
        const div = document.createElement('div');
        div.className = 'doc-item';
        div.innerHTML = `
            <div>
                <div class="doc-name">${doc.name}</div>
                <small style="color: #666;">Clique para preencher</small>
            </div>
            <div style="font-size:1.5rem;">${doc.icon}</div>
        `;
        div.onclick = () => openDocumentForm(doc);
        container.appendChild(div);
    });
}

// FORMUL√ÅRIOS DE DOCUMENTOS
function openDocumentForm(doc) {
    const patientSelect = document.getElementById('docPatientSelect');
    const patientId = patientSelect.value || currentPatientId;
    
    if (!patientId) {
        showToast('Selecione um paciente primeiro!');
        return;
    }
    
    currentDocType = doc;
    
    const modal = document.getElementById('documentModal');
    const title = document.getElementById('modalTitle');
    const body = document.getElementById('modalBody');
    
    title.textContent = doc.name;
    
    // Gerar HTML espec√≠fico baseado no tipo e profiss√£o
    body.innerHTML = generateDocumentHTML(doc.id, currentUser.profession, patientId);
    
    modal.style.display = 'flex';
    
    // Inicializar componentes espec√≠ficos
    setTimeout(() => {
        initAllCanvases();
        initProfessionSpecificFunctions(currentUser.profession, doc.id);
        
        // Se for evolu√ß√£o, adicionar listeners para auto-save
        if (doc.id === 'evolucao') {
            setupEvolucaoAutoSave();
        }
    }, 100);
}

function generateDocumentHTML(docType, profession, patientId) {
    const today = new Date().toISOString().split('T')[0];
    
    // HTML base comum
    let html = `
        <div class="form-card">
            <div class="form-title">üë§ Dados do Profissional</div>
            <div class="prof-row">
                <div class="form-group">
                    <label class="form-label">${currentProfession.name}</label>
                    <input type="text" class="form-input" id="doc-professional" value="${currentUser.name}" readonly>
                </div>
                <div class="form-group">
                    <label class="form-label">${currentProfession.registro}</label>
                    <input type="text" class="form-input" id="doc-registro" value="${currentUser.registro}" readonly>
                </div>
            </div>
        </div>
        
        <div class="form-card">
            <div class="form-title">üë§ Dados do Paciente</div>
            <div class="prof-row">
                <div class="form-group">
                    <label class="form-label">Data</label>
                    <input type="date" class="form-input" id="doc-date" value="${today}">
                </div>
                <div class="form-group">
                    <label class="form-label">Local</label>
                    <input type="text" class="form-input" id="doc-local" placeholder="Cl√≠nica/Cidade">
                </div>
            </div>
    `;
    
    // Adicionar conte√∫do espec√≠fico por profiss√£o e tipo
    html += getSpecificFormHTML(docType, profession);
    
    // Fechar div dos dados do paciente
    html += `</div>`;
    
    // Assinatura e bot√µes (comum a todos, exceto contrato que tem assinatura dupla)
    if (docType !== 'contrato') {
        html += `
            <div class="form-card">
                <div class="form-title">‚úçÔ∏è Assinatura Digital</div>
                <div class="assinatura-section">
                    <h4>Assine com o dedo na tela abaixo:</h4>
                    <div class="signature-area">
                        <canvas id="signatureCanvas" class="signature-pad"></canvas>
                        <span class="signature-label">Toque e arraste para assinar</span>
                    </div>
                    <div class="btn-group" style="margin-top: 10px;">
                        <button class="btn btn-danger btn-sm" onclick="clearSignature()" style="flex:none;">üóëÔ∏è Limpar</button>
                    </div>
                </div>
            </div>
        `;
    }
    
    html += `
        <div class="btn-group">
            <button class="btn btn-success" onclick="saveAndGeneratePDF()">üíæ Salvar e Gerar PDF</button>
            <button class="btn btn-secondary" onclick="closeDocumentModal()">Cancelar</button>
        </div>
    `;
    
    return html;
}

function getSpecificFormHTML(docType, profession) {
    let html = '';
    
    // EVOLU√á√ÉO - 10 CAMPOS EM BRANCO COM DATA ACIMA DE CADA UM
    if (docType === 'evolucao') {
        html += `
            <div class="form-group">
                <label class="form-label">Nome do Paciente</label>
                <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
            </div>
            
            <div class="form-group">
                <label class="form-label">N¬∫ da Sess√£o/Consulta</label>
                <input type="number" class="form-input" id="num-sessao" placeholder="N√∫mero">
            </div>
        `;
        
        // Gerar 10 campos de evolu√ß√£o com data acima de cada um
        for (let i = 1; i <= 10; i++) {
            html += `
                <div class="evolucao-campo">
                    <div class="form-group" style="margin-bottom:10px;">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input" id="evolucao-data-${i}" value="${new Date().toISOString().split('T')[0]}">
                    </div>
                    <textarea class="form-textarea evolucao-campo-texto" id="evolucao-${i}" placeholder="" style="min-height:80px;"></textarea>
                </div>
            `;
        }
    }
    
    // ALTA - MODELO √öNICO SIMPLES PARA TODAS AS PROFISS√ïES
    else if (docType === 'alta') {
        html += `
            <div class="form-group">
                <label class="form-label">Nome do Paciente</label>
                <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
            </div>
            <div class="prof-row">
                <div class="form-group">
                    <label class="form-label">Data de In√≠cio do Tratamento</label>
                    <input type="date" class="form-input" id="alta-data-inicio">
                </div>
                <div class="form-group">
                    <label class="form-label">Data da Alta</label>
                    <input type="date" class="form-input" id="alta-data-fim" value="${new Date().toISOString().split('T')[0]}">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Total de Sess√µes/Consultas Realizadas</label>
                <input type="number" class="form-input" id="alta-total-sessoes" placeholder="0">
            </div>
            
            <div class="form-group">
                <label class="form-label">Diagn√≥stico Inicial</label>
                <textarea class="form-textarea" id="alta-diagnostico-inicial" placeholder="Diagn√≥stico na entrada do tratamento..."></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Resumo do Tratamento</label>
                <textarea class="form-textarea" id="alta-resumo-tratamento" placeholder="Principais condutas realizadas durante todo o per√≠odo..."></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Evolu√ß√£o do Paciente</label>
                <textarea class="form-textarea" id="alta-evolucao" placeholder="Descri√ß√£o da evolu√ß√£o cl√≠nica desde o in√≠cio at√© a alta..."></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Condi√ß√£o na Alta</label>
                <textarea class="form-textarea" id="alta-condicao" placeholder="Estado atual do paciente ao t√©rmino do tratamento..."></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Motivo da Alta</label>
                <select class="form-select" id="alta-motivo">
                    <option value="objetivos">Objetivos terap√™uticos alcan√ßados</option>
                    <option value="parcial">Alta parcial (melhora significativa)</option>
                    <option value="solicitacao">Alta a pedido do paciente</option>
                    <option value="encaminhamento">Encaminhamento para outro profissional/especialidade</option>
                    <option value="abandono">Abandono do tratamento</option>
                    <option value="mudanca">Mudan√ßa de endere√ßo/cidade</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Orienta√ß√µes Finais</label>
                <textarea class="form-textarea" id="alta-orientacoes" placeholder="Recomenda√ß√µes para manuten√ß√£o dos resultados, cuidados preventivos, sinais de alerta..."></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Encaminhamentos (se houver)</label>
                <textarea class="form-textarea" id="alta-encaminhamentos" placeholder="Para qual profissional ou servi√ßo foi encaminhado..."></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">Retorno/Controle</label>
                <textarea class="form-textarea" id="alta-retorno" placeholder="Necessidade de retorno para controle, reavalia√ß√£o..."></textarea>
            </div>
        `;
    }
    
    // CONTRATO - NOVO M√ìDULO COM CL√ÅUSULAS JUR√çDICAS V√ÅLIDAS
    else if (docType === 'contrato') {
        html += `
            <div class="form-group">
                <label class="form-label">Nome do Contratante (Paciente/Respons√°vel Legal)</label>
                <input type="text" class="form-input" id="contratante-nome" placeholder="Nome completo">
            </div>
            <div class="prof-row">
                <div class="form-group">
                    <label class="form-label">CPF</label>
                    <input type="text" class="form-input" id="contratante-cpf" placeholder="000.000.000-00" oninput="maskCPF(event)">
                </div>
                <div class="form-group">
                    <label class="form-label">RG</label>
                    <input type="text" class="form-input" id="contratante-rg" placeholder="N¬∫ do RG">
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Endere√ßo Completo</label>
                <input type="text" class="form-input" id="contratante-endereco" placeholder="Rua, n√∫mero, bairro, cidade, estado, CEP">
            </div>
            <div class="prof-row">
                <div class="form-group">
                    <label class="form-label">Telefone</label>
                    <input type="text" class="form-input" id="contratante-telefone" placeholder="(00) 00000-0000" oninput="maskPhone(event)">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-input" id="contratante-email" placeholder="email@exemplo.com">
                </div>
            </div>
            
            <div class="form-card" style="margin-top:20px;">
                <div class="form-title">üìã Dados do Servi√ßo</div>
                <div class="form-group">
                    <label class="form-label">Queixa Principal / Diagn√≥stico</label>
                    <textarea class="form-textarea" id="contrato-queixa" placeholder="Descri√ß√£o da condi√ß√£o cl√≠nica ou objetivo do tratamento..."></textarea>
                </div>
                <div class="prof-row">
                    <div class="form-group">
                        <label class="form-label">Modalidade de Atendimento</label>
                        <select class="form-select" id="contrato-modalidade">
                            <option value="presencial">Presencial (Cl√≠nica/Consult√≥rio)</option>
                            <option value="domiciliar">Domiciliar</option>
                            <option value="online">Online/Teleatendimento</option>
                            <option value="hibrido">H√≠brido (Presencial + Online)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor por Sess√£o (R$)</label>
                        <input type="number" class="form-input" id="contrato-valor" step="0.01" placeholder="0,00">
                    </div>
                </div>
                <div class="prof-row">
                    <div class="form-group">
                        <label class="form-label">Frequ√™ncia Semanal</label>
                        <select class="form-select" id="contrato-frequencia">
                            <option value="1x">1x por semana</option>
                            <option value="2x">2x por semana</option>
                            <option value="3x">3x por semana</option>
                            <option value="4x">4x ou mais por semana</option>
                            <option value="quinzenal">Quinzenal</option>
                            <option value="mensal">Mensal</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Dura√ß√£o da Sess√£o (minutos)</label>
                        <input type="number" class="form-input" id="contrato-duracao" placeholder="Ex: 50">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Forma de Pagamento</label>
                    <select class="form-select" id="contrato-pagamento">
                        <option value="pix">Pix</option>
                        <option value="dinheiro">Dinheiro</option>
                        <option value="cartao_credito">Cart√£o de Cr√©dito</option>
                        <option value="cartao_debito">Cart√£o de D√©bito</option>
                        <option value="transferencia">Transfer√™ncia Banc√°ria</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Dia do Vencimento</label>
                    <select class="form-select" id="contrato-vencimento">
                        <option value="na_sessao">No dia da sess√£o</option>
                        <option value="5">Todo dia 5</option>
                        <option value="10">Todo dia 10</option>
                        <option value="15">Todo dia 15</option>
                        <option value="20">Todo dia 20</option>
                    </select>
                </div>
            </div>
            
            <div class="form-card">
                <div class="form-title">üìÑ Cl√°usulas do Contrato</div>
                
                <div class="clausula-contrato">
                    <h5>CL√ÅUSULA 1 - IDENTIFICA√á√ÉO DAS PARTES</h5>
                    <p><strong>CONTRATANTE:</strong> <span id="texto-contratante-nome"></span>, CPF: <span id="texto-contratante-cpf"></span>, residente em <span id="texto-contratante-endereco"></span>.</p>
                    <p style="margin-top:8px;"><strong>CONTRATADO:</strong> ${currentUser.name}, ${currentProfession.registro}: ${currentUser.registro}, endere√ßo profissional informado no cabe√ßalho.</p>
                </div>
                
                <div class="clausula-contrato">
                    <h5>CL√ÅUSULA 2 - OBJETO</h5>
                    <p>O presente contrato tem por objeto a presta√ß√£o de servi√ßos ${currentProfession.name.toLowerCase()} pelo CONTRATADO ao CONTRATANTE, conforme avalia√ß√£o profissional e plano terap√™utico estabelecido.</p>
                </div>
                
                <div class="clausula-contrato">
                    <h5>CL√ÅUSULA 3 - OBRIGA√á√ïES DO CONTRATADO</h5>
                    <p>‚Ä¢ Realizar avalia√ß√£o profissional inicial;<br>
                    ‚Ä¢ Estabelecer diagn√≥stico e plano terap√™utico adequado;<br>
                    ‚Ä¢ Executar procedimentos com √©tica, t√©cnica e sigilo profissional;<br>
                    ‚Ä¢ Manter prontu√°rio atualizado e fornecer documenta√ß√£o necess√°ria;<br>
                    ‚Ä¢ Informar sobre riscos, benef√≠cios e alternativas do tratamento.</p>
                </div>
                
                <div class="clausula-contrato">
                    <h5>CL√ÅUSULA 4 - OBRIGA√á√ïES DO CONTRATANTE</h5>
                    <p>‚Ä¢ Comparecer √†s sess√µes agendadas no dia e hor√°rio combinados;<br>
                    ‚Ä¢ Informar mudan√ßas no estado de sa√∫de e medicamentos em uso;<br>
                    ‚Ä¢ Efetuar pagamentos conforme estabelecido neste contrato;<br>
                    ‚Ä¢ Seguir as orienta√ß√µes profissionais prescritas;<br>
                    ‚Ä¢ Comunicar com anteced√™ncia impossibilidade de comparecimento.</p>
                </div>
                
                <div class="clausula-contrato">
                    <h5>CL√ÅUSULA 5 - CANCELAMENTOS E FALTAS</h5>
                    <p><strong>5.1</strong> O CONTRATANTE poder√° cancelar ou remarcar sess√µes mediante aviso pr√©vio de <strong>6 horas</strong> de anteced√™ncia.<br><br>
                    <strong>5.2</strong> Cancelamentos com menos de 6 horas de anteced√™ncia ou faltas sem comunica√ß√£o ser√£o cobradas em <strong>20%</strong> do valor da sess√£o.<br><br>
                    <strong>5.3</strong> Ap√≥s <strong>3 faltas consecutivas</strong> sem justificativa, o CONTRATADO poder√° rescindir o contrato unilateralmente.</p>
                </div>
                
                <div class="clausula-contrato">
                    <h5>CL√ÅUSULA 6 - RESCIS√ÉO E QUEBRA DE CONTRATO</h5>
                    <p><strong>6.1</strong> O CONTRATANTE poder√° rescindir este contrato a qualquer momento, mediante solicita√ß√£o por escrito.<br><br>
                    <strong>6.2</strong> Em caso de rescis√£o sem justificativa m√©dica ou de for√ßa maior antes de completar <strong>50% do tratamento previsto</strong>, ser√° cobrada multa de <strong>50%</strong> sobre o valor total das sess√µes restantes.<br><br>
                    <strong>6.3</strong> O CONTRATADO poder√° rescindir o contrato em caso de viola√ß√£o das obriga√ß√µes pelo CONTRATANTE ou impossibilidade t√©cnica de continuidade.</p>
                </div>
                
                <div class="clausula-contrato">
                    <h5>CL√ÅUSULA 7 - SIGILO PROFISSIONAL</h5>
                    <p>O CONTRATADO compromete-se a manter sigilo absoluto sobre todas as informa√ß√µes do CONTRATANTE, conforme c√≥digo de √©tica profissional e legisla√ß√£o vigente (LGPD).</p>
                </div>
                
                <div class="clausula-contrato">
                    <h5>CL√ÅUSULA 8 - VIG√äNCIA</h5>
                    <p>Este contrato entra em vigor na data de assinatura e permanecer√° v√°lido at√© o t√©rmino do tratamento ou rescis√£o por qualquer das partes conforme cl√°usulas anteriores.</p>
                </div>
                
                <div class="clausula-contrato">
                    <h5>CL√ÅUSULA 9 - DISPOSI√á√ïES GERAIS</h5>
                    <p>‚Ä¢ O n√£o exerc√≠cio de direitos n√£o implica ren√∫ncia;<br>
                    ‚Ä¢ Acordos verbais s√≥ ter√£o validade se confirmados por escrito;<br>
                    ‚Ä¢ Quest√µes n√£o previstas ser√£o resolvidas conforme legisla√ß√£o vigente.</p>
                </div>
            </div>
            
            <div class="form-card">
                <div class="form-title">‚úçÔ∏è Assinaturas</div>
                <p style="margin-bottom:15px;font-size:0.9rem;">Local e data: ___________________, ${new Date().toLocaleDateString('pt-BR', {day: '2-digit', month: 'long', year: 'numeric'})}</p>
                
                <div class="assinatura-dupla">
                    <div class="assinatura-box">
                        <h5>CONTRATANTE (Paciente/Respons√°vel)</h5>
                        <div class="signature-area" style="margin-bottom:10px;">
                            <canvas id="signatureCanvasContratante" class="signature-pad" style="height:120px;"></canvas>
                            <span class="signature-label">Assinatura do Contratante</span>
                        </div>
                        <button class="btn btn-danger btn-sm" onclick="clearSignatureById('signatureCanvasContratante')" style="width:100%;">üóëÔ∏è Limpar</button>
                        <p style="margin-top:10px;font-size:0.85rem;text-align:center;">
                            <span id="assinatura-contratante-nome"></span><br>
                            CPF: <span id="assinatura-contratante-cpf"></span>
                        </p>
                    </div>
                    
                    <div class="assinatura-box">
                        <h5>CONTRATADO (${currentProfession.name})</h5>
                        <div class="signature-area" style="margin-bottom:10px;">
                            <canvas id="signatureCanvasProfissional" class="signature-pad" style="height:120px;"></canvas>
                            <span class="signature-label">Assinatura do Profissional</span>
                        </div>
                        <button class="btn btn-danger btn-sm" onclick="clearSignatureById('signatureCanvasProfissional')" style="width:100%;">üóëÔ∏è Limpar</button>
                        <p style="margin-top:10px;font-size:0.85rem;text-align:center;">
                            ${currentUser.name}<br>
                            ${currentProfession.registro}: ${currentUser.registro}
                        </p>
                    </div>
                </div>
            </div>
        `;
    }
    
    // FISIOTERAPIA - Anamnese e Avalia√ß√£o espec√≠ficas
    else if (profession === 'fisioterapia') {
        if (docType === 'anamnese' || docType === 'avaliacao') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="prof-row-3">
                    <div class="form-group">
                        <label class="form-label">Idade</label>
                        <input type="number" class="form-input" id="paciente-idade" placeholder="Anos">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Profiss√£o</label>
                        <input type="text" class="form-input" id="paciente-profissao" placeholder="Profiss√£o">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data Avalia√ß√£o</label>
                        <input type="date" class="form-input" id="paciente-data-avaliacao">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Queixa Principal</label>
                    <textarea class="form-textarea" id="queixa-principal" placeholder="Descreva a queixa principal do paciente..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Hist√≥ria da Doen√ßa Atual (HDA)</label>
                    <textarea class="form-textarea" id="hda" placeholder="Como come√ßou? Quando come√ßou? Evolu√ß√£o dos sintomas..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Hist√≥ria Patol√≥gica Pregressa (HPP)</label>
                    <textarea class="form-textarea" id="hpp" placeholder="Doen√ßas pr√©vias, cirurgias, interna√ß√µes..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Medicamentos em Uso</label>
                    <textarea class="form-textarea" id="medicamentos" placeholder="Medica√ß√µes atuais..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Hist√≥ria Familiar</label>
                    <textarea class="form-textarea" id="hf" placeholder="Doen√ßas na fam√≠lia..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">H√°bitos de Vida</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="tabagista">
                            <span>Tabagista</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="etilista">
                            <span>Etilista</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="atividade-fisica">
                            <span>Atividade F√≠sica</span>
                        </label>
                    </div>
                </div>
            `;
            
            if (docType === 'avaliacao') {
                html += `
                    <div class="form-card" style="margin-top:20px;">
                        <div class="form-title">üò£ Escala Num√©rica da Dor</div>
                        <div class="escala-dor">
                            <h4>Toque no n√∫mero correspondente √† dor (0 a 10)</h4>
                            <div class="escala-numeros">
                                ${[0,1,2,3,4,5,6,7,8,9,10].map(n => `
                                    <button type="button" class="numero-dor ${n <= 3 ? 'dor-leve' : n <= 6 ? 'dor-media' : 'dor-intensa'}" 
                                            data-valor="${n}" onclick="selecionarDor(this)">${n}</button>
                                `).join('')}
                            </div>
                            <div class="escala-linha"></div>
                            <div class="escala-labels">
                                <span>Sem dor</span>
                                <span>Dor leve</span>
                                <span>Dor moderada</span>
                                <span>Dor intensa</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-card">
                        <div class="form-title">‚≠ê Estrela da Dor - Avalia√ß√£o dos Movimentos</div>
                        <div class="estrela-dor-container">
                            <h4>Toque nos bot√µes para indicar dor nos movimentos</h4>
                            <div class="regioes-dor">
                                ${['Lombar', 'Tor√°cica', 'Cervical'].map(regiao => `
                                    <div class="regiao-item">
                                        <h5>Regi√£o ${regiao}</h5>
                                        <div class="movimentos-grid">
                                            ${['Flex√£o (F)', 'Extens√£o (E)', 'Incl. Esq (Se)', 'Incl. Dir (Sd)', 'Rota√ß√£o Esq (Re)', 'Rota√ß√£o Dir (Rd)'].map(mov => `
                                                <div class="movimento-item">
                                                    <h6>${mov}</h6>
                                                    <div class="movimento-botoes">
                                                        <button type="button" class="btn-dor" onclick="toggleDor(this)">Com dor</button>
                                                        <button type="button" class="btn-dor" onclick="toggleDor(this)">Sem dor</button>
                                                    </div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-card">
                        <div class="form-title">üéØ Captores Posturais</div>
                        <div class="captores-grid">
                            ${['Olho', 'ATM', 'P√©', 'Cicatrizes', 'V√≠sceras'].map(captor => `
                                <div class="captor-item">
                                    <div class="captor-header">
                                        <span class="captor-nome">${captor}</span>
                                        <div class="captor-botoes">
                                            <button type="button" class="btn-captor" onclick="toggleCaptor(this, 'positivo')">Positivo</button>
                                            <button type="button" class="btn-captor" onclick="toggleCaptor(this, 'negativo')">Negativo</button>
                                        </div>
                                    </div>
                                    <input type="text" class="captor-obs" placeholder="Observa√ß√µes...">
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Testes Especiais</label>
                        <textarea class="form-textarea" id="testes-especiais" placeholder="Descreva os testes realizados..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Diagn√≥stico Fisioterap√™utico</label>
                        <textarea class="form-textarea" id="diagnostico-fisio" placeholder="Diagn√≥stico cin√©tico-funcional..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Objetivos Terap√™uticos</label>
                        <textarea class="form-textarea" id="objetivos" placeholder="Objetivos de curto e longo prazo..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Plano Terap√™utico</label>
                        <textarea class="form-textarea" id="plano-terapeutico" placeholder="Condutas e procedimentos planejados..."></textarea>
                    </div>
                `;
            }
        } else if (docType === 'atestado') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="form-group">
                    <label class="form-label">Tipo de Atestado</label>
                    <select class="form-select" id="atestado-tipo" onchange="toggleAtestadoDias()">
                        <option value="comparecimento">Atestado de Comparecimento</option>
                        <option value="afastamento">Atestado de Afastamento</option>
                        <option value="restricao">Atestado com Restri√ß√£o Funcional</option>
                    </select>
                </div>
                <div class="prof-row">
                    <div class="form-group">
                        <label class="form-label">Hor√°rio de In√≠cio</label>
                        <input type="time" class="form-input" id="atestado-hora-inicio">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hor√°rio de T√©rmino</label>
                        <input type="time" class="form-input" id="atestado-hora-fim">
                    </div>
                </div>
                <div class="form-group" id="atestado-dias-group" style="display:none;">
                    <label class="form-label">Quantidade de Dias de Afastamento</label>
                    <input type="number" class="form-input" id="atestado-dias" placeholder="0">
                </div>
                <div class="form-group">
                    <label class="form-label">CID (se houver)</label>
                    <input type="text" class="form-input" id="atestado-cid" placeholder="C√≥digo CID">
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes / Restri√ß√µes</label>
                    <textarea class="form-textarea" id="atestado-obs" placeholder="Descreva as restri√ß√µes ou observa√ß√µes necess√°rias..."></textarea>
                </div>
            `;
        } else if (docType === 'tcle') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="prof-row">
                    <div class="form-group">
                        <label class="form-label">Data de Nascimento</label>
                        <input type="date" class="form-input" id="paciente-nascimento">
                    </div>
                    <div class="form-group">
                        <label class="form-label">CPF</label>
                        <input type="text" class="form-input" id="paciente-cpf" placeholder="000.000.000-00">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Respons√°vel Legal (se menor de idade)</label>
                    <input type="text" class="form-input" id="responsavel-nome" placeholder="Nome do respons√°vel">
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">üìã Termo de Consentimento Livre e Esclarecido</div>
                    <div style="background:var(--cinza-claro);padding:15px;border-radius:10px;font-size:0.9rem;line-height:1.6;max-height:400px;overflow-y:auto;">
                        <p>Eu, <strong>_____________________________________</strong>, abaixo identificado(a), declaro que:</p>
                        <p style="margin-top:15px;"><strong>1.</strong> Fui devidamente informado(a) sobre a natureza, os objetivos, os benef√≠cios, os riscos e as alternativas do tratamento fisioterap√™utico proposto.</p>
                        <p><strong>2.</strong> Compreendi que o tratamento envolve: avalia√ß√£o f√≠sica, procedimentos terap√™uticos manuais, exerc√≠cios terap√™uticos, eletroterapia e outros recursos fisioterap√™uticos conforme indica√ß√£o.</p>
                        <p><strong>3.</strong> Estou ciente de que podem ocorrer desconfortos tempor√°rios como dor muscular tardia, cansa√ßo ou aumento tempor√°rio dos sintomas.</p>
                        <p><strong>4.</strong> Autorizo a coleta de dados para fins de documenta√ß√£o cl√≠nica, ensino e pesquisa (quando aplic√°vel), preservando meu anonimato.</p>
                        <p><strong>5.</strong> Tenho liberdade de retirar este consentimento a qualquer momento, sem penalidades.</p>
                        <p><strong>6.</strong> Todas as minhas d√∫vidas foram esclarecidas.</p>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Procedimentos Espec√≠ficos Autorizados</label>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="tcle-avaliacao" checked>
                            <span>Avalia√ß√£o F√≠sica</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="tcle-manual" checked>
                            <span>Terapia Manual</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="tcle-exercicios" checked>
                            <span>Exerc√≠cios Terap√™uticos</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="tcle-eletro" checked>
                            <span>Recursos Eletroter√°picos</span>
                        </label>
                    </div>
                </div>
            `;
        } else if (docType === 'comparecimento') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="prof-row">
                    <div class="form-group">
                        <label class="form-label">CPF</label>
                        <input type="text" class="form-input" id="paciente-cpf" placeholder="000.000.000-00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-input" id="comparecimento-data" value="${new Date().toISOString().split('T')[0]}">
                    </div>
                </div>
                <div class="prof-row">
                    <div class="form-group">
                        <label class="form-label">Hor√°rio de Entrada</label>
                        <input type="time" class="form-input" id="comparecimento-entrada">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hor√°rio de Sa√≠da</label>
                        <input type="time" class="form-input" id="comparecimento-saida">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Finalidade do Atendimento</label>
                    <input type="text" class="form-input" id="comparecimento-finalidade" placeholder="Ex: Avalia√ß√£o fisioterap√™utica">
                </div>
            `;
        } else if (docType === 'reembolso') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="prof-row">
                    <div class="form-group">
                        <label class="form-label">Data de Nascimento</label>
                        <input type="date" class="form-input" id="paciente-nascimento">
                    </div>
                    <div class="form-group">
                        <label class="form-label">CPF</label>
                        <input type="text" class="form-input" id="paciente-cpf" placeholder="000.000.000-00">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Conv√™nio/Plano de Sa√∫de</label>
                    <input type="text" class="form-input" id="convenio-nome" placeholder="Nome do conv√™nio">
                </div>
                <div class="form-group">
                    <label class="form-label">N¬∫ da Carteirinha</label>
                    <input type="text" class="form-input" id="convenio-carteirinha" placeholder="N√∫mero da carteirinha">
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">üè• Dados Cl√≠nicos</div>
                    <div class="form-group">
                        <label class="form-label">Diagn√≥stico M√©dico / CID</label>
                        <input type="text" class="form-input" id="reembolso-cid" placeholder="CID">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Diagn√≥stico Fisioterap√™utico</label>
                        <textarea class="form-textarea" id="reembolso-diagnostico" placeholder="Diagn√≥stico funcional..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Justificativa para o Tratamento</label>
                        <textarea class="form-textarea" id="reembolso-justificativa" placeholder="Por que o tratamento √© necess√°rio..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üìä Sess√µes Realizadas</div>
                    <div class="prof-row">
                        <div class="form-group">
                            <label class="form-label">Quantidade de Sess√µes</label>
                            <input type="number" class="form-input" id="reembolso-qtd" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Per√≠odo (In√≠cio)</label>
                            <input type="date" class="form-input" id="reembolso-inicio">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Per√≠odo (Fim)</label>
                            <input type="date" class="form-input" id="reembolso-fim">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Procedimentos Realizados (detalhado)</label>
                        <textarea class="form-textarea" id="reembolso-procedimentos" placeholder="Liste todos os procedimentos realizados..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Evolu√ß√£o do Paciente</label>
                        <textarea class="form-textarea" id="reembolso-evolucao" placeholder="Descri√ß√£o da evolu√ß√£o durante o tratamento..."></textarea>
                    </div>
                </div>
            `;
        } else if (docType === 'encaminhamento') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="prof-row">
                    <div class="form-group">
                        <label class="form-label">Data de Nascimento</label>
                        <input type="date" class="form-input" id="paciente-nascimento">
                    </div>
                    <div class="form-group">
                        <label class="form-label">CPF</label>
                        <input type="text" class="form-input" id="paciente-cpf" placeholder="000.000.000-00">
                    </div>
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">‚û°Ô∏è Dados do Encaminhamento</div>
                    <div class="form-group">
                        <label class="form-label">Profissional/Servi√ßo de Destino</label>
                        <input type="text" class="form-input" id="enc-destino" placeholder="Nome do profissional ou servi√ßo">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Especialidade</label>
                        <input type="text" class="form-input" id="enc-especialidade" placeholder="Ex: Ortopedia, Neurologia...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Motivo do Encaminhamento</label>
                        <textarea class="form-textarea" id="enc-motivo" placeholder="Por que o paciente est√° sendo encaminhado..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üìù Resumo Cl√≠nico</div>
                    <div class="form-group">
                        <label class="form-label">Hist√≥rico / Queixa Principal</label>
                        <textarea class="form-textarea" id="enc-historico" placeholder="Resumo do hist√≥rico cl√≠nico..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Achados Relevantes da Avalia√ß√£o</label>
                        <textarea class="form-textarea" id="enc-achados" placeholder="Principais achados da avalia√ß√£o fisioterap√™utica..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Condutas j√° Realizadas</label>
                        <textarea class="form-textarea" id="enc-condutas" placeholder="Tratamentos j√° realizados..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Solicita√ß√£o ao Profissional de Destino</label>
                        <textarea class="form-textarea" id="enc-solicitacao" placeholder="O que se solicita do pr√≥ximo profissional..."></textarea>
                    </div>
                </div>
            `;
        }
    }
    
    // NUTRI√á√ÉO - Anamnese e Avalia√ß√£o espec√≠ficas
    else if (profession === 'nutricao') {
        if (docType === 'anamnese') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="prof-row-3">
                    <div class="form-group">
                        <label class="form-label">Data de Nascimento</label>
                        <input type="date" class="form-input" id="paciente-nascimento">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sexo</label>
                        <select class="form-select" id="paciente-sexo">
                            <option value="F">Feminino</option>
                            <option value="M">Masculino</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Estado Civil</label>
                        <select class="form-select" id="paciente-estado-civil">
                            <option value="solteiro">Solteiro(a)</option>
                            <option value="casado">Casado(a)</option>
                            <option value="divorciado">Divorciado(a)</option>
                            <option value="viuvo">Vi√∫vo(a)</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">üçΩÔ∏è Hist√≥ria Alimentar</div>
                    <div class="form-group">
                        <label class="form-label">Queixa Principal Nutricional</label>
                        <textarea class="form-textarea" id="queixa-nutricional" placeholder="Por que procurou atendimento nutricional..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Peso Atual (kg)</label>
                        <input type="number" class="form-input" id="peso-atual" step="0.1" placeholder="0,0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Peso Habitual (kg)</label>
                        <input type="number" class="form-input" id="peso-habitual" step="0.1" placeholder="0,0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Altura (cm)</label>
                        <input type="number" class="form-input" id="altura" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hist√≥ria de Peso (√∫ltimos 6 meses)</label>
                        <textarea class="form-textarea" id="historia-peso" placeholder="Ganho/perda de peso, dietas anteriores..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">ü•ó Recordat√≥rio Alimentar 24h</div>
                    <div class="form-group">
                        <label class="form-label">Caf√© da Manh√£</label>
                        <textarea class="form-textarea" id="refeicao-cafe" placeholder="Descreva o caf√© da manh√£..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Lanche da Manh√£</label>
                        <textarea class="form-textarea" id="refeicao-lanche-manha" placeholder="Descreva o lanche..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Almo√ßo</label>
                        <textarea class="form-textarea" id="refeicao-almoco" placeholder="Descreva o almo√ßo..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Lanche da Tarde</label>
                        <textarea class="form-textarea" id="refeicao-lanche-tarde" placeholder="Descreva o lanche..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Jantar</label>
                        <textarea class="form-textarea" id="refeicao-jantar" placeholder="Descreva o jantar..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ceia</label>
                        <textarea class="form-textarea" id="refeicao-ceia" placeholder="Descreva a ceia..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üíä Hist√≥ria Cl√≠nica</div>
                    <div class="form-group">
                        <label class="form-label">Doen√ßas Pr√©vias / Comorbidades</label>
                        <textarea class="form-textarea" id="comorbidades" placeholder="Diabetes, hipertens√£o, dislipidemia..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Uso de Medicamentos</label>
                        <textarea class="form-textarea" id="medicamentos" placeholder="Medicamentos em uso cont√≠nuo..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Alergias Alimentares / Intoler√¢ncias</label>
                        <textarea class="form-textarea" id="alergias" placeholder="Descreva alergias ou intoler√¢ncias..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hist√≥ria Familiar</label>
                        <textarea class="form-textarea" id="historia-familiar" placeholder="Doen√ßas na fam√≠lia..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üèÉ H√°bitos de Vida</div>
                    <div class="form-group">
                        <label class="form-label">Atividade F√≠sica</label>
                        <select class="form-select" id="atividade-fisica">
                            <option value="sedentario">Sedent√°rio</option>
                            <option value="leve">Atividade Leve</option>
                            <option value="moderada">Atividade Moderada</option>
                            <option value="intensa">Atividade Intensa</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Consumo de √Ågua (litros/dia)</label>
                        <input type="number" class="form-input" id="consumo-agua" step="0.1" placeholder="0,0">
                    </div>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="fumante">
                            <span>Fumante</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="etilista">
                            <span>Consome √°lcool</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Prefer√™ncias Alimentares / Avers√µes</label>
                    <textarea class="form-textarea" id="preferencias" placeholder="Alimentos que gosta ou n√£o gosta..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Rotina de Trabalho/Estudo</label>
                    <textarea class="form-textarea" id="rotina" placeholder="Hor√°rios, possibilidade de refei√ß√µes..."></textarea>
                </div>
            `;
        } else if (docType === 'avaliacao') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">üìè Avalia√ß√£o Antropom√©trica</div>
                    <div class="prof-row-4">
                        <div class="form-group">
                            <label class="form-label">Peso (kg)</label>
                            <input type="number" class="form-input" id="antropo-peso" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Altura (m)</label>
                            <input type="number" class="form-input" id="antropo-altura" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">IMC</label>
                            <input type="text" class="form-input" id="antropo-imc" readonly placeholder="Calculado">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Classifica√ß√£o IMC</label>
                            <input type="text" class="form-input" id="antropo-classificacao" readonly>
                        </div>
                    </div>
                    
                    <div class="prof-row-4">
                        <div class="form-group">
                            <label class="form-label">Circ. Cintura (cm)</label>
                            <input type="number" class="form-input" id="antropo-cintura" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Circ. Quadril (cm)</label>
                            <input type="number" class="form-input" id="antropo-quadril" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Raz√£o C/Q</label>
                            <input type="text" class="form-input" id="antropo-rcq" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">% Gordura</label>
                            <input type="number" class="form-input" id="antropo-gordura" step="0.1">
                        </div>
                    </div>
                    
                    <div class="prof-row">
                        <div class="form-group">
                            <label class="form-label">Circ. Bra√ßo (cm)</label>
                            <input type="number" class="form-input" id="antropo-braco" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Circ. Panturrilha (cm)</label>
                            <input type="number" class="form-input" id="antropo-panturrilha" step="0.1">
                        </div>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üî¨ Avalia√ß√£o Bioqu√≠mica (se houver)</div>
                    <div class="form-group">
                        <label class="form-label">Glicemia de Jejum</label>
                        <input type="text" class="form-input" id="bio-glicemia" placeholder="mg/dL">
                    </div>
                    <div class="prof-row">
                        <div class="form-group">
                            <label class="form-label">Colesterol Total</label>
                            <input type="text" class="form-input" id="bio-colesterol" placeholder="mg/dL">
                        </div>
                        <div class="form-group">
                            <label class="form-label">HDL</label>
                            <input type="text" class="form-input" id="bio-hdl" placeholder="mg/dL">
                        </div>
                    </div>
                    <div class="prof-row">
                        <div class="form-group">
                            <label class="form-label">LDL</label>
                            <input type="text" class="form-input" id="bio-ldl" placeholder="mg/dL">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Triglicer√≠deos</label>
                            <input type="text" class="form-input" id="bio-triglicerideos" placeholder="mg/dL">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Outros Exames</label>
                        <textarea class="form-textarea" id="bio-outros" placeholder="Demais exames laboratoriais..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">ü©∫ Avalia√ß√£o Cl√≠nica</div>
                    <div class="form-group">
                        <label class="form-label">Sinais Vitais</label>
                        <div class="prof-row">
                            <div class="form-group">
                                <label class="form-label">PA (mmHg)</label>
                                <input type="text" class="form-input" id="clinica-pa" placeholder="120/80">
                            </div>
                            <div class="form-group">
                                <label class="form-label">FC (bpm)</label>
                                <input type="number" class="form-input" id="clinica-fc">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Estado Geral / Inspe√ß√£o</label>
                        <textarea class="form-textarea" id="clinica-inspecao" placeholder="Observa√ß√µes cl√≠nicas..."></textarea>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Diagn√≥stico Nutricional</label>
                    <textarea class="form-textarea" id="diagnostico-nutricional" placeholder="Classifica√ß√£o nutricional segundo..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Objetivos Terap√™uticos Nutricionais</label>
                    <textarea class="form-textarea" id="objetivos-nutricao" placeholder="Objetivos de curto e longo prazo..."></textarea>
                </div>
            `;
        } else if (docType === 'plano') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="form-group">
                    <label class="form-label">Data do Plano</label>
                    <input type="date" class="form-input" id="plano-data" value="${new Date().toISOString().split('T')[0]}">
                </div>
                <div class="form-group">
                    <label class="form-label">Vig√™ncia do Plano</label>
                    <input type="text" class="form-input" id="plano-vigencia" placeholder="Ex: 30 dias">
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">üç≥ Caf√© da Manh√£ - 07:00</div>
                    <div id="cafe-alimentos">
                        <div class="alimento-row">
                            <input type="text" class="form-input" placeholder="Alimento" style="flex:2;">
                            <input type="text" class="form-input" placeholder="Quantidade">
                            <input type="text" class="form-input" placeholder="Medida">
                        </div>
                    </div>
                    <button type="button" class="btn-add-alimento" onclick="addAlimentoRow('cafe')">+ Adicionar Alimento</button>
                </div>
                
                <div class="form-card">
                    <div class="form-title">ü•™ Lanche da Manh√£ - 10:00</div>
                    <div id="lanche-manha-alimentos">
                        <div class="alimento-row">
                            <input type="text" class="form-input" placeholder="Alimento" style="flex:2;">
                            <input type="text" class="form-input" placeholder="Quantidade">
                            <input type="text" class="form-input" placeholder="Medida">
                        </div>
                    </div>
                    <button type="button" class="btn-add-alimento" onclick="addAlimentoRow('lanche-manha')">+ Adicionar Alimento</button>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üçΩÔ∏è Almo√ßo - 12:30</div>
                    <div id="almoco-alimentos">
                        <div class="alimento-row">
                            <input type="text" class="form-input" placeholder="Alimento" style="flex:2;">
                            <input type="text" class="form-input" placeholder="Quantidade">
                            <input type="text" class="form-input" placeholder="Medida">
                        </div>
                    </div>
                    <button type="button" class="btn-add-alimento" onclick="addAlimentoRow('almoco')">+ Adicionar Alimento</button>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üçé Lanche da Tarde - 15:30</div>
                    <div id="lanche-tarde-alimentos">
                        <div class="alimento-row">
                            <input type="text" class="form-input" placeholder="Alimento" style="flex:2;">
                            <input type="text" class="form-input" placeholder="Quantidade">
                            <input type="text" class="form-input" placeholder="Medida">
                        </div>
                    </div>
                    <button type="button" class="btn-add-alimento" onclick="addAlimentoRow('lanche-tarde')">+ Adicionar Alimento</button>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üç≤ Jantar - 19:00</div>
                    <div id="jantar-alimentos">
                        <div class="alimento-row">
                            <input type="text" class="form-input" placeholder="Alimento" style="flex:2;">
                            <input type="text" class="form-input" placeholder="Quantidade">
                            <input type="text" class="form-input" placeholder="Medida">
                        </div>
                    </div>
                    <button type="button" class="btn-add-alimento" onclick="addAlimentoRow('jantar')">+ Adicionar Alimento</button>
                </div>
                
                <div class="form-card">
                    <div class="form-title">ü•õ Ceia - 21:30</div>
                    <div id="ceia-alimentos">
                        <div class="alimento-row">
                            <input type="text" class="form-input" placeholder="Alimento" style="flex:2;">
                            <input type="text" class="form-input" placeholder="Quantidade">
                            <input type="text" class="form-input" placeholder="Medida">
                        </div>
                    </div>
                    <button type="button" class="btn-add-alimento" onclick="addAlimentoRow('ceia')">+ Adicionar Alimento</button>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üíß Hidrata√ß√£o</div>
                    <div class="form-group">
                        <label class="form-label">Quantidade de √Ågua Recomendada</label>
                        <input type="text" class="form-input" id="plano-agua" placeholder="Ex: 2,5 litros por dia">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Orienta√ß√µes Gerais</label>
                    <textarea class="form-textarea" id="plano-orientacoes" placeholder="Orienta√ß√µes sobre preparo, substitui√ß√µes, suplementa√ß√£o..."></textarea>
                </div>
            `;
        } else if (docType === 'atestado') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="form-group">
                    <label class="form-label">Tipo de Atestado</label>
                    <select class="form-select" id="atestado-tipo">
                        <option value="comparecimento">Comparecimento</option>
                        <option value="afastamento">Afastamento</option>
                    </select>
                </div>
                <div class="prof-row">
                    <div class="form-group">
                        <label class="form-label">Hor√°rio In√≠cio</label>
                        <input type="time" class="form-input" id="atestado-inicio">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hor√°rio Fim</label>
                        <input type="time" class="form-input" id="atestado-fim">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea class="form-textarea" id="atestado-obs" placeholder="Observa√ß√µes necess√°rias..."></textarea>
                </div>
            `;
        }
    }
    
    // PSICOLOGIA - Anamnese e Avalia√ß√£o espec√≠ficas
    else if (profession === 'psicologia') {
        if (docType === 'anamnese') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="prof-row-3">
                    <div class="form-group">
                        <label class="form-label">Data de Nascimento</label>
                        <input type="date" class="form-input" id="paciente-nascimento">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sexo</label>
                        <select class="form-select" id="paciente-sexo">
                            <option value="F">Feminino</option>
                            <option value="M">Masculino</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Estado Civil</label>
                        <select class="form-select" id="paciente-estado-civil">
                            <option value="solteiro">Solteiro(a)</option>
                            <option value="casado">Casado(a)</option>
                            <option value="divorciado">Divorciado(a)</option>
                            <option value="viuvo">Vi√∫vo(a)</option>
                            <option value="uniao">Uni√£o Est√°vel</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Escolaridade</label>
                    <input type="text" class="form-input" id="paciente-escolaridade" placeholder="N√≠vel de escolaridade">
                </div>
                <div class="form-group">
                    <label class="form-label">Ocupa√ß√£o Profissional</label>
                    <input type="text" class="form-input" id="paciente-ocupacao" placeholder="Profiss√£o/Trabalho atual">
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">üß† Queixa e Motivo da Consulta</div>
                    <div class="form-group">
                        <label class="form-label">Queixa Principal</label>
                        <textarea class="form-textarea" id="queixa-principal" placeholder="Por que procurou atendimento psicol√≥gico..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tempo de Dura√ß√£o dos Sintomas</label>
                        <input type="text" class="form-input" id="duracao-sintomas" placeholder="H√° quanto tempo os sintomas persistem">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hist√≥rico da Queixa</label>
                        <textarea class="form-textarea" id="historia-queixa" placeholder="Como come√ßou, evolu√ß√£o, fatores desencadeantes..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üë®‚Äçüë©‚Äçüëß Hist√≥ria Pessoal e Familiar</div>
                    <div class="form-group">
                        <label class="form-label">Hist√≥ria de Vida / Desenvolvimento</label>
                        <textarea class="form-textarea" id="historia-vida" placeholder="Aspectos relevantes da inf√¢ncia, adolesc√™ncia, vida adulta..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Din√¢mica Familiar</label>
                        <textarea class="form-textarea" id="dinamica-familiar" placeholder="Composi√ß√£o familiar, relacionamentos, eventos significativos..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hist√≥rico de Doen√ßas Mentais na Fam√≠lia</label>
                        <textarea class="form-textarea" id="historia-familiar-mental" placeholder="Doen√ßas psiqui√°tricas na fam√≠lia..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üíä Hist√≥ria Cl√≠nica</div>
                    <div class="form-group">
                        <label class="form-label">Uso de Medicamentos Psiqui√°tricos (atual ou pr√©vio)</label>
                        <textarea class="form-textarea" id="medicamentos-psiquiatricos" placeholder="Medicamentos, doses, tempo de uso..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hist√≥rico de Interna√ß√µes Psiqui√°tricas</label>
                        <textarea class="form-textarea" id="internacoes" placeholder="Interna√ß√µes anteriores, motivos..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tentativas de Suic√≠dio / Autoagress√£o</label>
                        <textarea class="form-textarea" id="autoagressao" placeholder="Hist√≥rico de comportamentos de risco..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Uso de Subst√¢ncias Psicoativas</label>
                        <textarea class="form-textarea" id="substancias" placeholder="√Ålcool, drogas, medicamentos n√£o prescritos..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üòä Avalia√ß√£o do Estado Mental (Mini-Mental)</div>
                    <div class="form-group">
                        <label class="form-label">Apar√™ncia e Comportamento</label>
                        <textarea class="form-textarea" id="aparencia" placeholder="Postura, higiene, contato visual..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Humor e Afeto</label>
                        <textarea class="form-textarea" id="humor" placeholder="Estado emocional observado..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pensamento (curso e conte√∫do)</label>
                        <textarea class="form-textarea" id="pensamento" placeholder="Observa√ß√µes sobre o fluxo de pensamento..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sensorial e Percep√ß√£o</label>
                        <textarea class="form-textarea" id="sensorial" placeholder="Alucina√ß√µes, ilus√µes..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Insight e Julgamento</label>
                        <textarea class="form-textarea" id="insight" placeholder="Consci√™ncia da condi√ß√£o, capacidade de julgamento..."></textarea>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Hip√≥tese Diagn√≥stica / Impress√£o Cl√≠nica</label>
                    <textarea class="form-textarea" id="hipotese-diagnostica" placeholder="Impress√£o cl√≠nica inicial..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Plano Terap√™utico Proposto</label>
                    <textarea class="form-textarea" id="plano-terapeutico" placeholder="Abordagem, frequ√™ncia, objetivos..."></textarea>
                </div>
            `;
        } else if (docType === 'avaliacao') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">üéØ Avalia√ß√£o Psicol√≥gica</div>
                    <div class="form-group">
                        <label class="form-label">Instrumentos/Tests Aplicados</label>
                        <textarea class="form-textarea" id="instrumentos" placeholder="Testes psicol√≥gicos utilizados..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Resultados dos Testes</label>
                        <textarea class="form-textarea" id="resultados-testes" placeholder="Resultados quantitativos e qualitativos..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üìä √Åreas Avaliadas</div>
                    <div class="form-group">
                        <label class="form-label">Cogni√ß√£o</label>
                        <textarea class="form-textarea" id="av-cognicao" placeholder="Aten√ß√£o, mem√≥ria, fun√ß√µes executivas..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Emo√ß√£o</label>
                        <textarea class="form-textarea" id="av-emocao" placeholder="Regula√ß√£o emocional, express√£o afetiva..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Comportamento</label>
                        <textarea class="form-textarea" id="av-comportamento" placeholder="Padr√µes comportamentais observados..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Rela√ß√µes Interpessoais</label>
                        <textarea class="form-textarea" id="av-relacoes" placeholder="Qualidade das rela√ß√µes sociais..."></textarea>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Diagn√≥stico Psicol√≥gico (CID ou CIE)</label>
                    <input type="text" class="form-input" id="diagnostico-cid" placeholder="C√≥digo e descri√ß√£o">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Recomenda√ß√µes</label>
                    <textarea class="form-textarea" id="recomendacoes" placeholder="Encaminhamentos, interven√ß√µes sugeridas..."></textarea>
                </div>
            `;
        } else if (docType === 'relatorio') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="form-group">
                    <label class="form-label">Destinat√°rio do Relat√≥rio</label>
                    <input type="text" class="form-input" id="relatorio-destinatario" placeholder="Nome do m√©dico/institui√ß√£o">
                </div>
                <div class="form-group">
                    <label class="form-label">Finalidade do Relat√≥rio</label>
                    <input type="text" class="form-input" id="relatorio-finalidade" placeholder="Ex: Avalia√ß√£o para cirurgia bari√°trica">
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">üìù Conte√∫do do Relat√≥rio</div>
                    <div class="form-group">
                        <label class="form-label">Resumo do Hist√≥rico</label>
                        <textarea class="form-textarea" id="rel-historico" placeholder="Breve resumo do hist√≥rico do paciente..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Procedimentos de Avalia√ß√£o</label>
                        <textarea class="form-textarea" id="rel-procedimentos" placeholder="Testes e entrevistas realizadas..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Resultados</label>
                        <textarea class="form-textarea" id="rel-resultados" placeholder="Principais achados..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Conclus√µes</label>
                        <textarea class="form-textarea" id="rel-conclusoes" placeholder="Conclus√µes t√©cnicas..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Recomenda√ß√µes</label>
                        <textarea class="form-textarea" id="rel-recomendacoes" placeholder="Recomenda√ß√µes finais..."></textarea>
                    </div>
                </div>
            `;
        } else if (docType === 'atestado') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="form-group">
                    <label class="form-label">Tipo de Atestado</label>
                    <select class="form-select" id="atestado-tipo">
                        <option value="comparecimento">Atestado de Comparecimento</option>
                        <option value="afastamento">Atestado de Afastamento</option>
                    </select>
                </div>
                <div class="prof-row">
                    <div class="form-group">
                        <label class="form-label">Hor√°rio In√≠cio</label>
                        <input type="time" class="form-input" id="atestado-inicio">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hor√°rio Fim</label>
                        <input type="time" class="form-input" id="atestado-fim">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea class="form-textarea" id="atestado-obs" placeholder="Observa√ß√µes..."></textarea>
                </div>
            `;
        }
    }
    
    // MEDICINA - Anamnese e Avalia√ß√£o espec√≠ficas
    else if (profession === 'medicina') {
        if (docType === 'anamnese') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="prof-row-3">
                    <div class="form-group">
                        <label class="form-label">Data de Nascimento</label>
                        <input type="date" class="form-input" id="paciente-nascimento">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sexo</label>
                        <select class="form-select" id="paciente-sexo">
                            <option value="F">Feminino</option>
                            <option value="M">Masculino</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Estado Civil</label>
                        <select class="form-select" id="paciente-estado-civil">
                            <option value="solteiro">Solteiro(a)</option>
                            <option value="casado">Casado(a)</option>
                            <option value="divorciado">Divorciado(a)</option>
                            <option value="viuvo">Vi√∫vo(a)</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Ocupa√ß√£o</label>
                    <input type="text" class="form-input" id="paciente-ocupacao" placeholder="Profiss√£o">
                </div>
                <div class="form-group">
                    <label class="form-label">Naturalidade/Proced√™ncia</label>
                    <input type="text" class="form-input" id="paciente-naturalidade" placeholder="Cidade/Estado de origem">
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">ü©∫ Queixa Principal e Hist√≥ria da Doen√ßa Atual</div>
                    <div class="form-group">
                        <label class="form-label">Queixa Principal (QP)</label>
                        <input type="text" class="form-input" id="queixa-principal" placeholder="Em at√© uma frase">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hist√≥ria da Doen√ßa Atual (HDA)</label>
                        <textarea class="form-textarea" id="hda" placeholder="In√≠cio, evolu√ß√£o, tratamentos anteriores..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üìã Hist√≥ria Patol√≥gica Pregressa (HPP)</div>
                    <div class="form-group">
                        <label class="form-label">Doen√ßas de Base</label>
                        <textarea class="form-textarea" id="hpp-doencas" placeholder="HAS, DM, dislipidemia, etc..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cirurgias Anteriores</label>
                        <textarea class="form-textarea" id="hpp-cirurgias" placeholder="Procedimentos cir√∫rgicos pr√©vios..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Interna√ß√µes Anteriores</label>
                        <textarea class="form-textarea" id="hpp-internacoes" placeholder="Motivos e datas..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Transfus√µes</label>
                        <textarea class="form-textarea" id="hpp-transfusoes" placeholder="Se houver..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Vacina√ß√£o</label>
                        <textarea class="form-textarea" id="hpp-vacinacao" placeholder="Esquema vacinal..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üíä Hist√≥ria Medicamentosa</div>
                    <div class="form-group">
                        <label class="form-label">Medicamentos em Uso (incluir dose e frequ√™ncia)</label>
                        <textarea class="form-textarea" id="medicamentos-uso" placeholder="Liste todos os medicamentos..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Alergias Medicamentosas</label>
                        <textarea class="form-textarea" id="alergias-medicamentos" placeholder="Rea√ß√µes al√©rgicas conhecidas..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üë®‚Äçüë©‚Äçüëß Hist√≥ria Familiar (HF)</div>
                    <div class="form-group">
                        <label class="form-label">Doen√ßas na Fam√≠lia</label>
                        <textarea class="form-textarea" id="hf-doencas" placeholder="HAS, DM, c√¢ncer, doen√ßas card√≠acas..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üå± Hist√≥ria Pessoal e Social (HPS)</div>
                    <div class="form-group">
                        <label class="form-label">H√°bitos (tabagismo, etilismo, outras drogas)</label>
                        <textarea class="form-textarea" id="hps-habitos" placeholder="Quantidade, tempo de uso..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Atividade F√≠sica</label>
                        <textarea class="form-textarea" id="hps-atividade" placeholder="Tipo, frequ√™ncia, dura√ß√£o..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Alimenta√ß√£o</label>
                        <textarea class="form-textarea" id="hps-alimentacao" placeholder="H√°bitos alimentares..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sono</label>
                        <textarea class="form-textarea" id="hps-sono" placeholder="Qualidade do sono..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üîç Revis√£o de Sistemas</div>
                    ${['Geral', 'Cardiovascular', 'Respirat√≥rio', 'Gastrointestinal', 'Geniturin√°rio', 'Neurol√≥gico', 'End√≥crino', 'Osteomuscular', 'Dermatol√≥gico'].map(sistema => `
                        <div class="sistema-item">
                            <div class="sistema-header">
                                <span class="sistema-nome">${sistema}</span>
                                <div class="sistema-status">
                                    <button type="button" class="btn-sistema" onclick="toggleSistema(this, 'normal')">Normal</button>
                                    <button type="button" class="btn-sistema" onclick="toggleSistema(this, 'alterado')">Alterado</button>
                                </div>
                            </div>
                            <input type="text" class="form-input" placeholder="Observa√ß√µes..." style="margin-top:5px;">
                        </div>
                    `).join('')}
                </div>
                
                <div class="form-group">
                    <label class="form-label">Hip√≥tese Diagn√≥stica</label>
                    <textarea class="form-textarea" id="hipotese-diagnostica" placeholder="Hip√≥teses diferenciais..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Conduta</label>
                    <textarea class="form-textarea" id="conduta" placeholder="Exames solicitados, tratamento iniciado..."></textarea>
                </div>
            `;
        } else if (docType === 'avaliacao') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">üîç Exame F√≠sico</div>
                    <div class="form-group">
                        <label class="form-label">Estado Geral</label>
                        <textarea class="form-textarea" id="ef-geral" placeholder="Bom, regular, grave..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sinais Vitais</label>
                        <div class="prof-row">
                            <div class="form-group">
                                <label class="form-label">PA (mmHg)</label>
                                <input type="text" class="form-input" id="ef-pa" placeholder="120/80">
                            </div>
                            <div class="form-group">
                                <label class="form-label">FC (bpm)</label>
                                <input type="number" class="form-input" id="ef-fc">
                            </div>
                            <div class="form-group">
                                <label class="form-label">FR (irpm)</label>
                                <input type="number" class="form-input" id="ef-fr">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Temp (¬∞C)</label>
                                <input type="number" class="form-input" id="ef-temp" step="0.1">
                            </div>
                        </div>
                        <div class="prof-row">
                            <div class="form-group">
                                <label class="form-label">SpO2 (%)</label>
                                <input type="number" class="form-input" id="ef-spo2">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Glicemia (mg/dL)</label>
                                <input type="number" class="form-input" id="ef-glicemia">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Peso (kg)</label>
                        <input type="number" class="form-input" id="ef-peso" step="0.1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Altura (m)</label>
                        <input type="number" class="form-input" id="ef-altura" step="0.01">
                    </div>
                    <div class="form-group">
                        <label class="form-label">IMC</label>
                        <input type="text" class="form-input" id="ef-imc" readonly>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üëÅÔ∏è Inspe√ß√£o Geral</div>
                    <div class="form-group">
                        <label class="form-label">Pele e Mucosas</label>
                        <textarea class="form-textarea" id="ef-pele" placeholder="Colora√ß√£o, les√µes, hidrata√ß√£o..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cabe√ßa e Pesco√ßo</label>
                        <textarea class="form-textarea" id="ef-cabeca" placeholder="Inspe√ß√£o e palpa√ß√£o..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">T√≥rax</label>
                        <textarea class="form-textarea" id="ef-torax" placeholder="Formato, simetria..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Abdome</label>
                        <textarea class="form-textarea" id="ef-abdome" placeholder="Aspecto, palpa√ß√£o..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Membros</label>
                        <textarea class="form-textarea" id="ef-membros" placeholder="Extremidades..."></textarea>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ausculta Card√≠aca</label>
                    <textarea class="form-textarea" id="ef-cardio" placeholder="Ritmo, frequ√™ncia, sopros..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ausculta Respirat√≥ria</label>
                    <textarea class="form-textarea" id="ef-pulmoes" placeholder="MV, ru√≠dos advent√≠cios..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Exame Neurol√≥gico</label>
                    <textarea class="form-textarea" id="ef-neuro" placeholder="N√≠vel de consci√™ncia, pupilas, for√ßa muscular, sensibilidade, reflexos..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Diagn√≥stico (CID-10)</label>
                    <input type="text" class="form-input" id="diagnostico-cid" placeholder="C√≥digo e descri√ß√£o">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Conduta</label>
                    <textarea class="form-textarea" id="conduta" placeholder="Conduta m√©dica..."></textarea>
                </div>
            `;
        } else if (docType === 'receituario') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="form-group">
                    <label class="form-label">Idade</label>
                    <input type="number" class="form-input" id="paciente-idade">
                </div>
                <div class="form-group">
                    <label class="form-label">Endere√ßo</label>
                    <input type="text" class="form-input" id="paciente-endereco" placeholder="Endere√ßo completo">
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">üíä Prescri√ß√£o M√©dica</div>
                    <div class="form-group">
                        <label class="form-label">Medicamento 1</label>
                        <textarea class="form-textarea" id="med1" placeholder="Nome do medicamento, concentra√ß√£o, quantidade, posologia..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Medicamento 2</label>
                        <textarea class="form-textarea" id="med2" placeholder="Nome do medicamento, concentra√ß√£o, quantidade, posologia..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Medicamento 3</label>
                        <textarea class="form-textarea" id="med3" placeholder="Nome do medicamento, concentra√ß√£o, quantidade, posologia..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Medicamento 4</label>
                        <textarea class="form-textarea" id="med4" placeholder="Nome do medicamento, concentra√ß√£o, quantidade, posologia..."></textarea>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Orienta√ß√µes Gerais</label>
                    <textarea class="form-textarea" id="orientacoes-receita" placeholder="Orienta√ß√µes sobre uso dos medicamentos..."></textarea>
                </div>
            `;
        } else if (docType === 'atestado') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="form-group">
                    <label class="form-label">Tipo de Atestado</label>
                    <select class="form-select" id="atestado-tipo">
                        <option value="comparecimento">Comparecimento</option>
                        <option value="afastamento">Afastamento por doen√ßa</option>
                        <option value="acompanhante">Acompanhamento de familiar</option>
                    </select>
                </div>
                <div class="prof-row">
                    <div class="form-group">
                        <label class="form-label">Hor√°rio In√≠cio</label>
                        <input type="time" class="form-input" id="atestado-inicio">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hor√°rio Fim</label>
                        <input type="time" class="form-input" id="atestado-fim">
                    </div>
                </div>
                <div class="form-group" id="atestado-dias-group">
                    <label class="form-label">Dias de Afastamento</label>
                    <input type="number" class="form-input" id="atestado-dias">
                </div>
                <div class="form-group">
                    <label class="form-label">CID</label>
                    <input type="text" class="form-input" id="atestado-cid" placeholder="C√≥digo CID-10">
                </div>
                <div class="form-group">
                    <label class="form-label">Progn√≥stico</label>
                    <select class="form-select" id="atestado-prognostico">
                        <option value="reserva">Reserva</option>
                        <option value="bom">Bom</option>
                        <option value="grave">Grave</option>
                    </select>
                </div>
            `;
        } else if (docType === 'relatorio') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="form-group">
                    <label class="form-label">Destinat√°rio</label>
                    <input type="text" class="form-input" id="relatorio-destinatario" placeholder="Nome do destinat√°rio">
                </div>
                <div class="form-group">
                    <label class="form-label">Finalidade</label>
                    <input type="text" class="form-input" id="relatorio-finalidade" placeholder="Finalidade do relat√≥rio">
                </div>
                <div class="form-group">
                    <label class="form-label">Resumo Cl√≠nico</label>
                    <textarea class="form-textarea" id="rel-resumo" placeholder="Resumo do caso..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Conduta M√©dica</label>
                    <textarea class="form-textarea" id="rel-conduta" placeholder="Procedimentos realizados..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Conclus√£o</label>
                    <textarea class="form-textarea" id="rel-conclusao" placeholder="Conclus√£o t√©cnica..."></textarea>
                </div>
            `;
        }
    }
    
    // FONOAUDIOLOGIA - Anamnese e Avalia√ß√£o espec√≠ficas
    else if (profession === 'fonoaudiologia') {
        if (docType === 'anamnese') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="prof-row-3">
                    <div class="form-group">
                        <label class="form-label">Data de Nascimento</label>
                        <input type="date" class="form-input" id="paciente-nascimento">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sexo</label>
                        <select class="form-select" id="paciente-sexo">
                            <option value="F">Feminino</option>
                            <option value="M">Masculino</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Idade</label>
                        <input type="text" class="form-input" id="paciente-idade" readonly placeholder="Calculada">
                    </div>
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">üëÇ Queixa e Motivo da Consulta</div>
                    <div class="form-group">
                        <label class="form-label">Queixa Principal</label>
                        <textarea class="form-textarea" id="queixa-principal" placeholder="Por que procurou atendimento fonoaudiol√≥gico..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hist√≥rico da Queixa</label>
                        <textarea class="form-textarea" id="historia-queixa" placeholder="Quando come√ßou, evolu√ß√£o..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üë∂ Hist√≥ria do Desenvolvimento (se aplic√°vel)</div>
                    <div class="form-group">
                        <label class="form-label">Desenvolvimento Motor</label>
                        <textarea class="form-textarea" id="dev-motor" placeholder="Sentou, engatinhou, andou..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Desenvolvimento da Linguagem</label>
                        <textarea class="form-textarea" id="dev-linguagem" placeholder="Primeiras palavras, frases..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Desenvolvimento Neuropsicomotor</label>
                        <textarea class="form-textarea" id="dev-neuro" placeholder="Observa√ß√µes sobre desenvolvimento..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üè• Hist√≥ria Cl√≠nica</div>
                    <div class="form-group">
                        <label class="form-label">Doen√ßas de Ouvido</label>
                        <textarea class="form-textarea" id="historia-ouvido" placeholder="Otites, cirurgias, zumbidos..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hist√≥ria de Aspira√ß√£o/Engasgos</label>
                        <textarea class="form-textarea" id="historia-aspiracao" placeholder="Epis√≥dios de engasgo..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Uso de Medicamentos</label>
                        <textarea class="form-textarea" id="medicamentos" placeholder="Medicamentos em uso..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hist√≥ria Familiar</label>
                        <textarea class="form-textarea" id="historia-familiar" placeholder="Surdez na fam√≠lia, problemas de fala..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üó£Ô∏è Aspectos da Comunica√ß√£o</div>
                    <div class="form-group">
                        <label class="form-label">Audi√ß√£o</label>
                        <textarea class="form-textarea" id="com-audicao" placeholder="Queixas auditivas..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Linguagem Expressiva</label>
                        <textarea class="form-textarea" id="com-expressiva" placeholder="Como se expressa..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Linguagem Receptiva</label>
                        <textarea class="form-textarea" id="com-receptiva" placeholder="Compreens√£o de comandos..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fala</label>
                        <textarea class="form-textarea" id="com-fala" placeholder="Articula√ß√£o, flu√™ncia, voz..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Degluti√ß√£o</label>
                        <textarea class="form-textarea" id="com-degluticao" placeholder="Dificuldades para engolir..."></textarea>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Hip√≥tese Diagn√≥stica Fonoaudiol√≥gica</label>
                    <textarea class="form-textarea" id="hipotese" placeholder="Impress√£o diagn√≥stica inicial..."></textarea>
                </div>
            `;
        } else if (docType === 'avaliacao') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">üé§ Avalia√ß√£o Auditiva</div>
                    <div class="form-group">
                        <label class="form-label">Observa√ß√£o Comportamental</label>
                        <textarea class="form-textarea" id="av-auditiva-comp" placeholder="Resposta a sons..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Audiometria (se realizada)</label>
                        <textarea class="form-textarea" id="av-audiometria" placeholder="Resultados..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Imitanciometria</label>
                        <textarea class="form-textarea" id="av-imitancia" placeholder="Resultados..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üó£Ô∏è Avalia√ß√£o da Linguagem</div>
                    <div class="form-group">
                        <label class="form-label">Testes Aplicados</label>
                        <textarea class="form-textarea" id="av-testes-ling" placeholder="Testes padronizados..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Aspectos Pragm√°ticos</label>
                        <textarea class="form-textarea" id="av-pragmatico" placeholder="Uso social da linguagem..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Aspectos Sem√¢nticos</label>
                        <textarea class="form-textarea" id="av-semantico" placeholder="Vocabul√°rio..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Aspectos Morfossint√°ticos</label>
                        <textarea class="form-textarea" id="av-morfosintaxe" placeholder="Estrutura das frases..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üéôÔ∏è Avalia√ß√£o da Fala</div>
                    <div class="form-group">
                        <label class="form-label">Articula√ß√£o</label>
                        <textarea class="form-textarea" id="av-articulacao" placeholder="Fonemas comprometidos..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Flu√™ncia</label>
                        <textarea class="form-textarea" id="av-fluencia" placeholder="Gagueira, disflu√™ncias..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Voz</label>
                        <textarea class="form-textarea" id="av-voz" placeholder="Qualidade vocal, resson√¢ncia..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Pros√≥dia</label>
                        <textarea class="form-textarea" id="av-prosodia" placeholder="Entona√ß√£o, ritmo..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üçΩÔ∏è Avalia√ß√£o da Degluti√ß√£o</div>
                    <div class="form-group">
                        <label class="form-label">Observa√ß√£o Cl√≠nica</label>
                        <textarea class="form-textarea" id="av-deglut-clinica" placeholder="Sinais de aspira√ß√£o..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Avalia√ß√£o Instrumental (se houver)</label>
                        <textarea class="form-textarea" id="av-deglut-inst" placeholder="Videofluoroscopia, FEES..."></textarea>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Diagn√≥stico Fonoaudiol√≥gico</label>
                    <textarea class="form-textarea" id="diagnostico-fono" placeholder="CID-10 ou classifica√ß√£o..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Progn√≥stico</label>
                    <select class="form-select" id="prognostico">
                        <option value="favoravel">Favor√°vel</option>
                        <option value="reservado">Reservado</option>
                        <option value="desfavoravel">Desfavor√°vel</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Plano Terap√™utico</label>
                    <textarea class="form-textarea" id="plano-terapeutico" placeholder="Objetivos e condutas..."></textarea>
                </div>
            `;
        } else if (docType === 'relatorio') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="form-group">
                    <label class="form-label">Destinat√°rio</label>
                    <input type="text" class="form-input" id="relatorio-destinatario" placeholder="M√©dico/Institui√ß√£o">
                </div>
                <div class="form-group">
                    <label class="form-label">Objetivo do Relat√≥rio</label>
                    <input type="text" class="form-input" id="relatorio-objetivo" placeholder="Finalidade">
                </div>
                <div class="form-group">
                    <label class="form-label">S√≠ntese da Avalia√ß√£o</label>
                    <textarea class="form-textarea" id="rel-sintese" placeholder="Resumo dos achados..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Conclus√£o e Recomenda√ß√µes</label>
                    <textarea class="form-textarea" id="rel-conclusao" placeholder="Conclus√µes t√©cnicas..."></textarea>
                </div>
            `;
        } else if (docType === 'atestado') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="form-group">
                    <label class="form-label">Tipo</label>
                    <select class="form-select" id="atestado-tipo">
                        <option value="comparecimento">Comparecimento</option>
                        <option value="afastamento">Afastamento</option>
                    </select>
                </div>
                <div class="prof-row">
                    <div class="form-group">
                        <label class="form-label">In√≠cio</label>
                        <input type="time" class="form-input" id="atestado-inicio">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fim</label>
                        <input type="time" class="form-input" id="atestado-fim">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea class="form-textarea" id="atestado-obs"></textarea>
                </div>
            `;
        }
    }
    
    // TERAPIA OCUPACIONAL - Anamnese e Avalia√ß√£o espec√≠ficas
    else if (profession === 'terapiaocupacional') {
        if (docType === 'anamnese') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="prof-row-3">
                    <div class="form-group">
                        <label class="form-label">Data de Nascimento</label>
                        <input type="date" class="form-input" id="paciente-nascimento">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sexo</label>
                        <select class="form-select" id="paciente-sexo">
                            <option value="F">Feminino</option>
                            <option value="M">Masculino</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Idade</label>
                        <input type="text" class="form-input" id="paciente-idade" readonly>
                    </div>
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">üèÉ Queixa e Motivo da Consulta</div>
                    <div class="form-group">
                        <label class="form-label">Queixa Principal</label>
                        <textarea class="form-textarea" id="queixa-principal" placeholder="Por que procurou TO..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hist√≥ria da Queixa</label>
                        <textarea class="form-textarea" id="historia-queixa" placeholder="Evolu√ß√£o, fatores desencadeantes..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üë∂ Hist√≥ria do Desenvolvimento</div>
                    <div class="form-group">
                        <label class="form-label">Hist√≥ria Gestacional e Nascimento</label>
                        <textarea class="form-textarea" id="dev-gestacao" placeholder="Pr√©-natal, parto, intercorr√™ncias..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Marcos do Desenvolvimento</label>
                        <textarea class="form-textarea" id="dev-marcos" placeholder="Controle cervical, sentar, engatinhar, andar..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Desenvolvimento da Escrita</label>
                        <textarea class="form-textarea" id="dev-escrita" placeholder="Preens√£o, pin√ßa, desenho..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Desenvolvimento da Autonomia</label>
                        <textarea class="form-textarea" id="dev-autonomia" placeholder="Vestir, alimentar, higiene..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üè• Hist√≥ria Cl√≠nica</div>
                    <div class="form-group">
                        <label class="form-label">Diagn√≥stico M√©dico</label>
                        <input type="text" class="form-input" id="diagnostico-medico" placeholder="CID">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Doen√ßas Associadas</label>
                        <textarea class="form-textarea" id="doencas-associadas" placeholder="Comorbidades..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cirurgias Realizadas</label>
                        <textarea class="form-textarea" id="cirurgias" placeholder="Procedimentos cir√∫rgicos..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Uso de Medicamentos</label>
                        <textarea class="form-textarea" id="medicamentos" placeholder="Medica√ß√µes..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Terapias Anteriores</label>
                        <textarea class="form-textarea" id="terapias-anteriores" placeholder="Fisioterapia, fonoaudiologia, psicologia..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üè† Contexto Familiar e Social</div>
                    <div class="form-group">
                        <label class="form-label">Composi√ß√£o Familiar</label>
                        <textarea class="form-textarea" id="familia-comp" placeholder="Quem mora com o paciente..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Din√¢mica Familiar</label>
                        <textarea class="form-textarea" id="familia-dinamica" placeholder="Rela√ß√µes familiares..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Escola/Trabalho</label>
                        <textarea class="form-textarea" id="escola-trabalho" placeholder="Adapta√ß√£o, desempenho..."></textarea>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Hip√≥tese Diagn√≥stica TO</label>
                    <textarea class="form-textarea" id="hipotese-to" placeholder="Impress√£o diagn√≥stica..."></textarea>
                </div>
            `;
        } else if (docType === 'avaliacao') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                
                <div class="form-card" style="margin-top:20px;">
                    <div class="form-title">ü§è Avalia√ß√£o Sensorial</div>
                    <div class="form-group">
                        <label class="form-label">T√°til</label>
                        <textarea class="form-textarea" id="av-tatil" placeholder="Discrimina√ß√£o t√°til..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Propriocep√ß√£o</label>
                        <textarea class="form-textarea" id="av-propriocepcao" placeholder="Consci√™ncia corporal..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Vestibular</label>
                        <textarea class="form-textarea" id="av-vestibular" placeholder="Equil√≠brio, coordena√ß√£o..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Visual</label>
                        <textarea class="form-textarea" id="av-visual" placeholder="Percep√ß√£o visual..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Auditiva</label>
                        <textarea class="form-textarea" id="av-auditiva" placeholder="Processamento auditivo..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">‚úã Avalia√ß√£o Motora</div>
                    <div class="form-group">
                        <label class="form-label">Coordena√ß√£o Motora Grossa</label>
                        <textarea class="form-textarea" id="av-grossa" placeholder="Correr, pular, lan√ßar..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Coordena√ß√£o Motora Fina</label>
                        <textarea class="form-textarea" id="av-fina" placeholder="Pin√ßa, manipula√ß√£o..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Praxias</label>
                        <textarea class="form-textarea" id="av-praxias" placeholder="Ideomotora, ideat√≥ria, construcional..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">T√¥nus e Postura</label>
                        <textarea class="form-textarea" id="av-tonus" placeholder="Observa√ß√µes..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üß© Avalia√ß√£o Cognitiva</div>
                    <div class="form-group">
                        <label class="form-label">Aten√ß√£o</label>
                        <textarea class="form-textarea" id="av-atencao" placeholder="Sustentada, seletiva, alternada..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Mem√≥ria</label>
                        <textarea class="form-textarea" id="av-memoria" placeholder="Visual, auditiva, sequencial..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fun√ß√µes Executivas</label>
                        <textarea class="form-textarea" id="av-executivas" placeholder="Planejamento, organiza√ß√£o..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Resolu√ß√£o de Problemas</label>
                        <textarea class="form-textarea" id="av-problemas" placeholder="Estrat√©gias utilizadas..."></textarea>
                    </div>
                </div>
                
                <div class="form-card">
                    <div class="form-title">üìù Avalia√ß√£o do Desempenho Ocupacional</div>
                    <div class="form-group">
                        <label class="form-label">AVDs (Atividades de Vida Di√°ria)</label>
                        <textarea class="form-textarea" id="av-avds" placeholder="Alimenta√ß√£o, higiene, vestu√°rio..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">AVDIs (Instrumentais)</label>
                        <textarea class="form-textarea" id="av-avdis" placeholder="Cozinhar, telefonar, dinheiro..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Participa√ß√£o em Brincadeiras/Trabalho</label>
                        <textarea class="form-textarea" id="av-participacao" placeholder="Intera√ß√£o social, brinquedos..."></textarea>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Diagn√≥stico TO (CID)</label>
                    <input type="text" class="form-input" id="diagnostico-to" placeholder="C√≥digo CID">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Metas e Objetivos Terap√™uticos</label>
                    <textarea class="form-textarea" id="metas-to" placeholder="Objetivos mensur√°veis..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Plano de Interven√ß√£o</label>
                    <textarea class="form-textarea" id="plano-intervencao" placeholder="Estrat√©gias e abordagens..."></textarea>
                </div>
            `;
        } else if (docType === 'relatorio') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="form-group">
                    <label class="form-label">Destinat√°rio</label>
                    <input type="text" class="form-input" id="relatorio-destinatario" placeholder="M√©dico/Institui√ß√£o">
                </div>
                <div class="form-group">
                    <label class="form-label">Finalidade</label>
                    <input type="text" class="form-input" id="relatorio-finalidade" placeholder="Finalidade do relat√≥rio">
                </div>
                <div class="form-group">
                    <label class="form-label">Resumo da Avalia√ß√£o TO</label>
                    <textarea class="form-textarea" id="rel-resumo" placeholder="S√≠ntese dos achados..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Conclus√£o e Recomenda√ß√µes</label>
                    <textarea class="form-textarea" id="rel-conclusao" placeholder="Conclus√µes t√©cnicas..."></textarea>
                </div>
            `;
        } else if (docType === 'atestado') {
            html += `
                <div class="form-group">
                    <label class="form-label">Nome do Paciente</label>
                    <input type="text" class="form-input" id="paciente-nome" placeholder="Nome completo">
                </div>
                <div class="form-group">
                    <label class="form-label">Tipo</label>
                    <select class="form-select" id="atestado-tipo">
                        <option value="comparecimento">Comparecimento</option>
                        <option value="afastamento">Afastamento</option>
                    </select>
                </div>
                <div class="prof-row">
                    <div class="form-group">
                        <label class="form-label">In√≠cio</label>
                        <input type="time" class="form-input" id="atestado-inicio">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fim</label>
                        <input type="time" class="form-input" id="atestado-fim">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea class="form-textarea" id="atestado-obs"></textarea>
                </div>
            `;
        }
    }
    
    return html;
}

// FUN√á√ïES ESPEC√çFICAS POR PROFISS√ÉO
function initProfessionSpecificFunctions(profession, docType) {
    // Inicializar assinaturas
    initAllCanvases();
    
    // Se for contrato, atualizar dados din√¢micos
    if (docType === 'contrato') {
        updateContratoDados();
        
        // Adicionar listeners para atualizar dados em tempo real
        document.getElementById('contratante-nome')?.addEventListener('input', updateContratoDados);
        document.getElementById('contratante-cpf')?.addEventListener('input', updateContratoDados);
        document.getElementById('contratante-endereco')?.addEventListener('input', updateContratoDados);
    }
    
    // Inicializar fun√ß√µes espec√≠ficas
    if (profession === 'fisioterapia' && (docType === 'anamnese' || docType === 'avaliacao')) {
        // Escala de dor j√° est√° no HTML
    }
    
    if (profession === 'nutricao' && docType === 'avaliacao') {
        // Calcular IMC automaticamente
        const pesoInput = document.getElementById('antropo-peso');
        const alturaInput = document.getElementById('antropo-altura');
        
        if (pesoInput && alturaInput) {
            const calcularIMC = () => {
                const peso = parseFloat(pesoInput.value);
                const altura = parseFloat(alturaInput.value);
                if (peso && altura) {
                    const imc = peso / (altura * altura);
                    document.getElementById('antropo-imc').value = imc.toFixed(2);
                    
                    let classificacao = '';
                    if (imc < 18.5) classificacao = 'Abaixo do peso';
                    else if (imc < 25) classificacao = 'Peso normal';
                    else if (imc < 30) classificacao = 'Sobrepeso';
                    else if (imc < 35) classificacao = 'Obesidade Grau I';
                    else if (imc < 40) classificacao = 'Obesidade Grau II';
                    else classificacao = 'Obesidade Grau III';
                    
                    document.getElementById('antropo-classificacao').value = classificacao;
                }
            };
            
            pesoInput.addEventListener('input', calcularIMC);
            alturaInput.addEventListener('input', calcularIMC);
        }
    }
}

// Setup auto-save para evolu√ß√£o quando todos os 10 campos estiverem preenchidos
function setupEvolucaoAutoSave() {
    const checkAndSave = () => {
        let allFilled = true;
        for (let i = 1; i <= 10; i++) {
            const campo = document.getElementById(`evolucao-${i}`);
            if (!campo || !campo.value.trim()) {
                allFilled = false;
                break;
            }
        }
        
        if (allFilled) {
            // Todos os campos preenchidos, salvar automaticamente
            showToast('‚úÖ Todos os campos preenchidos! Salvando automaticamente...');
            setTimeout(() => {
                saveAndGeneratePDF();
            }, 1000);
        }
    };
    
    // Adicionar listener em todos os campos de evolu√ß√£o
    for (let i = 1; i <= 10; i++) {
        const campo = document.getElementById(`evolucao-${i}`);
        if (campo) {
            campo.addEventListener('blur', checkAndSave);
        }
    }
}

// Atualizar dados do contrato em tempo real
function updateContratoDados() {
    const nome = document.getElementById('contratante-nome')?.value || '_____________________________________';
    const cpf = document.getElementById('contratante-cpf')?.value || '_____________________________________';
    const endereco = document.getElementById('contratante-endereco')?.value || '_____________________________________';
    
    const textoNome = document.getElementById('texto-contratante-nome');
    const textoCPF = document.getElementById('texto-contratante-cpf');
    const textoEndereco = document.getElementById('texto-contratante-endereco');
    const assinaturaNome = document.getElementById('assinatura-contratante-nome');
    const assinaturaCPF = document.getElementById('assinatura-contratante-cpf');
    
    if (textoNome) textoNome.textContent = nome;
    if (textoCPF) textoCPF.textContent = cpf;
    if (textoEndereco) textoEndereco.textContent = endereco;
    if (assinaturaNome) assinaturaNome.textContent = nome;
    if (assinaturaCPF) assinaturaCPF.textContent = cpf;
}

// FUN√á√ïES DE INTERA√á√ÉO
function selecionarDor(elemento) {
    document.querySelectorAll('.numero-dor').forEach(el => el.classList.remove('selected'));
    elemento.classList.add('selected');
    nivelDorSelecionado = elemento.getAttribute('data-valor');
}

function toggleDor(botao) {
    const container = botao.parentElement;
    container.querySelectorAll('.btn-dor').forEach(btn => {
        btn.classList.remove('selected-com-dor', 'selected-sem-dor');
    });
    if (botao.textContent.includes('Com')) {
        botao.classList.add('selected-com-dor');
    } else {
        botao.classList.add('selected-sem-dor');
    }
}

function toggleCaptor(botao, tipo) {
    const container = botao.parentElement;
    container.querySelectorAll('.btn-captor').forEach(btn => {
        btn.classList.remove('selected-positivo', 'selected-negativo');
    });
    if (tipo === 'positivo') {
        botao.classList.add('selected-positivo');
    } else {
        botao.classList.add('selected-negativo');
    }
}

function toggleSistema(botao, tipo) {
    const container = botao.parentElement;
    container.querySelectorAll('.btn-sistema').forEach(btn => {
        btn.classList.remove('selected-normal', 'selected-alterado');
    });
    if (tipo === 'normal') {
        botao.classList.add('selected-normal');
    } else {
        botao.classList.add('selected-alterado');
    }
}

function addAlimentoRow(refeicao) {
    const container = document.getElementById(refeicao + '-alimentos');
    if (container) {
        const row = document.createElement('div');
        row.className = 'alimento-row';
        row.innerHTML = `
            <input type="text" class="form-input" placeholder="Alimento" style="flex:2;">
            <input type="text" class="form-input" placeholder="Quantidade">
            <input type="text" class="form-input" placeholder="Medida">
        `;
        container.appendChild(row);
    }
}

function toggleAtestadoDias() {
    const tipo = document.getElementById('atestado-tipo')?.value;
    const diasGroup = document.getElementById('atestado-dias-group');
    if (diasGroup) {
        diasGroup.style.display = tipo === 'afastamento' ? 'block' : 'none';
    }
}

// ASSINATURAS
function initAllCanvases() {
    // Canvas padr√£o para documentos normais
    const canvas = document.getElementById('signatureCanvas');
    if (canvas && !assinaturas['signatureCanvas']) {
        initCanvas(canvas, 'signatureCanvas');
    }
    
    // Canvas para contratante (contrato)
    const canvasContratante = document.getElementById('signatureCanvasContratante');
    if (canvasContratante && !assinaturas['signatureCanvasContratante']) {
        initCanvas(canvasContratante, 'signatureCanvasContratante');
    }
    
    // Canvas para profissional (contrato)
    const canvasProfissional = document.getElementById('signatureCanvasProfissional');
    if (canvasProfissional && !assinaturas['signatureCanvasProfissional']) {
        initCanvas(canvasProfissional, 'signatureCanvasProfissional');
    }
}

function initCanvas(canvas, id) {
    const container = canvas.parentElement;
    canvas.width = container.offsetWidth - 4;
    canvas.height = 150;
    
    const ctx = canvas.getContext('2d');
    ctx.strokeStyle = '#1e3a5f';
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
    
    let isDrawing = false;
    
    function startDrawing(e) {
        isDrawing = true;
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX || e.touches[0].clientX) - rect.left;
        const y = (e.clientY || e.touches[0].clientY) - rect.top;
        ctx.beginPath();
        ctx.moveTo(x, y);
        const label = canvas.parentElement.querySelector('.signature-label');
        if (label) label.style.display = 'none';
        e.preventDefault();
    }
    
    function draw(e) {
        if (!isDrawing) return;
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX || e.touches[0].clientX) - rect.left;
        const y = (e.clientY || e.touches[0].clientY) - rect.top;
        ctx.lineTo(x, y);
        ctx.stroke();
        e.preventDefault();
    }
    
    function stopDrawing() {
        isDrawing = false;
    }
    
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    canvas.addEventListener('touchstart', startDrawing, {passive: false});
    canvas.addEventListener('touchmove', draw, {passive: false});
    canvas.addEventListener('touchend', stopDrawing);
    
    assinaturas[id] = { canvas, ctx, hasSignature: false };
}

function clearSignature() {
    clearSignatureById('signatureCanvas');
}

function clearSignatureById(canvasId) {
    const sig = assinaturas[canvasId];
    if (sig) {
        sig.ctx.clearRect(0, 0, sig.canvas.width, sig.canvas.height);
        sig.hasSignature = false;
        const label = sig.canvas.parentElement.querySelector('.signature-label');
        if (label) label.style.display = 'block';
    }
}

// SALVAR E GERAR PDF
function saveAndGeneratePDF() {
    const patientSelect = document.getElementById('docPatientSelect');
    const patientId = patientSelect.value || currentPatientId;
    const patientName = currentPatientData ? currentPatientData.name : 'Paciente';
    
    // Coletar todos os dados do formul√°rio
    const formData = {};
    document.querySelectorAll('#modalBody input, #modalBody textarea, #modalBody select').forEach(el => {
        if (el.id) {
            formData[el.id] = el.value;
        }
    });
    
    const docData = {
        type: currentDocType.id,
        docName: currentDocType.name,
        profession: currentUser.profession,
        patientId: patientId,
        patientName: patientName,
        date: document.getElementById('doc-date')?.value || new Date().toISOString().split('T')[0],
        location: document.getElementById('doc-local')?.value || '',
        formData: formData,
        professional: currentUser.name,
        registro: currentUser.registro,
        createdAt: new Date().toISOString()
    };
    
    // Coletar assinaturas
    if (currentDocType.id === 'contrato') {
        // Contrato tem duas assinaturas
        const canvasContratante = document.getElementById('signatureCanvasContratante');
        const canvasProfissional = document.getElementById('signatureCanvasProfissional');
        
        if (canvasContratante) {
            docData.signatureContratante = canvasContratante.toDataURL('image/png');
        }
        if (canvasProfissional) {
            docData.signatureProfissional = canvasProfissional.toDataURL('image/png');
        }
    } else {
        // Documentos normais t√™m uma assinatura
        const canvas = document.getElementById('signatureCanvas');
        if (canvas) {
            docData.signature = canvas.toDataURL('image/png');
        }
    }
    
    showLoading(true);
    
    const docRef = database.ref('documents/' + currentUser.cpf).push();
    docRef.set(docData)
        .then(() => {
            showLoading(false);
            generatePDF(docData);
            closeDocumentModal();
            if (currentPatientId) loadPatientDocuments(currentPatientId);
            loadAllDocuments();
        })
        .catch(error => {
            showLoading(false);
            showToast('Erro ao salvar: ' + error.message);
        });
}

// GERAR PDF - VERS√ÉO LIMPA SEM "SOBRE O DOCUMENTO"
function generatePDF(docData) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // Obter configura√ß√µes do profissional
    const clinicaNome = userConfig.clinica || currentUser.clinica || 'ASM DOCS Pro';
    const clinicaEndereco = userConfig.endereco || '';
    const clinicaTelefone = userConfig.telefone || currentUser.whatsapp || '';
    
    // CABE√áALHO PROFISSIONAL COMPLETO
    doc.setFillColor(30, 58, 95);
    doc.rect(0, 0, 210, 50, 'F');
    
    // Nome da cl√≠nica/empresa
    doc.setTextColor(201, 162, 39);
    doc.setFontSize(16);
    doc.text(clinicaNome.toUpperCase(), 105, 12, { align: 'center' });
    
    // Nome do profissional
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(12);
    doc.text(currentUser.name, 105, 22, { align: 'center' });
    
    // Registro profissional
    doc.setFontSize(10);
    doc.text(`${currentProfession.name} - ${currentProfession.registro}: ${currentUser.registro}`, 105, 30, { align: 'center' });
    
    // Contato
    if (clinicaTelefone) {
        doc.text(`Tel: ${clinicaTelefone}`, 105, 37, { align: 'center' });
    }
    if (currentUser.email) {
        doc.text(currentUser.email, 105, 44, { align: 'center' });
    }
    
    // Linha separadora dourada
    doc.setDrawColor(201, 162, 39);
    doc.setLineWidth(2);
    doc.line(20, 55, 190, 55);
    
    // T√≠tulo do documento
    doc.setFontSize(14);
    doc.setTextColor(30, 58, 95);
    doc.text(docData.docName.toUpperCase(), 105, 65, { align: 'center' });
    
    let y = 80;
    doc.setFontSize(10);
    doc.setTextColor(0, 0, 0);
    
    // Dados do paciente em formato profissional
    doc.setFont('helvetica', 'bold');
    doc.setFontSize(11);
    doc.text('DADOS DO PACIENTE', 20, y);
    y += 8;
    
    doc.setFont('helvetica', 'normal');
    doc.setFontSize(10);
    
    // Nome do paciente
    doc.setFont('helvetica', 'bold');
    doc.text('Nome:', 20, y);
    doc.setFont('helvetica', 'normal');
    doc.text(docData.patientName, 50, y);
    y += 6;
    
    // Data
    doc.setFont('helvetica', 'bold');
    doc.text('Data:', 20, y);
    doc.setFont('helvetica', 'normal');
    doc.text(new Date(docData.date).toLocaleDateString('pt-BR'), 50, y);
    y += 6;
    
    // Local se houver
    if (docData.location) {
        doc.setFont('helvetica', 'bold');
        doc.text('Local:', 20, y);
        doc.setFont('helvetica', 'normal');
        doc.text(docData.location, 50, y);
        y += 6;
    }
    
    y += 5;
    
    // Linha separadora
    doc.setDrawColor(200, 200, 200);
    doc.setLineWidth(0.5);
    doc.line(20, y, 190, y);
    y += 10;
    
    // CONTE√öDO DO DOCUMENTO - SEM SE√á√ÉO "SOBRE O DOCUMENTO"
    // Apenas os dados preenchidos, organizados por tipo de documento
    doc.setFont('helvetica', 'normal');
    doc.setFontSize(10);
    
    // Adicionar TODOS os dados do formul√°rio de forma organizada
    const formDataEntries = Object.entries(docData.formData || {});
    
    formDataEntries.forEach(([key, value]) => {
        // Pular campos de controle e metadados
        if (key.startsWith('doc-') || !value) return;
        
        if (y > 270) {
            doc.addPage();
            y = 20;
        }
        
        const label = formatLabel(key);
        
        // T√≠tulo do campo em negrito
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(10);
        doc.text(label + ':', 20, y);
        y += 5;
        
        // Valor do campo
        doc.setFont('helvetica', 'normal');
        doc.setFontSize(9);
        
        // Quebrar texto longo em m√∫ltiplas linhas
        const splitText = doc.splitTextToSize(String(value), 170);
        
        // Verificar se precisa de nova p√°gina
        if (y + (splitText.length * 4) > 270) {
            doc.addPage();
            y = 20;
        }
        
        doc.text(splitText, 25, y);
        y += (splitText.length * 4) + 4;
    });
    
    // ASSINATURAS
    if (docData.type === 'contrato') {
        // Contrato com assinaturas duplas
        if (y > 200) {
            doc.addPage();
            y = 20;
        }
        
        y += 10;
        doc.setFont('helvetica', 'bold');
        doc.setFontSize(11);
        doc.text('ASSINATURAS', 20, y);
        y += 15;
        
        // Assinatura do contratante
        if (docData.signatureContratante && y < 220) {
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(10);
            doc.text('CONTRATANTE:', 20, y);
            y += 5;
            doc.addImage(docData.signatureContratante, 'PNG', 20, y, 60, 30);
            y += 35;
            doc.setDrawColor(0, 0, 0);
            doc.line(20, y, 80, y);
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(9);
            doc.text(docData.formData['contratante-nome'] || 'Contratante', 20, y + 5);
            y += 15;
        }
        
        // Assinatura do profissional
        if (docData.signatureProfissional && y < 220) {
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(10);
            doc.text('CONTRATADO:', 20, y);
            y += 5;
            doc.addImage(docData.signatureProfissional, 'PNG', 20, y, 60, 30);
            y += 35;
            doc.setDrawColor(0, 0, 0);
            doc.line(20, y, 80, y);
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(9);
            doc.text(currentUser.name + ' - ' + currentUser.registro, 20, y + 5);
        }
    } else {
        // Assinatura √∫nica padr√£o
        if (y > 200) {
            doc.addPage();
            y = 20;
        }
        
        if (docData.signature) {
            y += 10;
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(11);
            doc.text('ASSINATURA DO PROFISSIONAL', 20, y);
            y += 5;
            doc.addImage(docData.signature, 'PNG', 20, y, 60, 30);
            y += 35;
            doc.setDrawColor(0, 0, 0);
            doc.line(20, y, 80, y);
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(9);
            doc.text(currentUser.name, 20, y + 5);
            doc.text(`${currentProfession.registro}: ${currentUser.registro}`, 20, y + 10);
        }
    }
    
    // RODAP√â EM TODAS AS P√ÅGINAS
    const pageCount = doc.internal.getNumberOfPages();
    for (let i = 1; i <= pageCount; i++) {
        doc.setPage(i);
        
        // Fundo do rodap√©
        doc.setFillColor(30, 58, 95);
        doc.rect(0, 280, 210, 20, 'F');
        
        // Texto do rodap√©
        doc.setFontSize(8);
        doc.setTextColor(201, 162, 39);
        doc.text(`ASM DOCS Pro - P√°gina ${i} de ${pageCount}`, 105, 288, { align: 'center' });
        doc.setTextColor(255, 255, 255);
        doc.text('¬© Dra. Andresa Augusto - Proibida reprodu√ß√£o sem autoriza√ß√£o', 105, 295, { align: 'center' });
    }
    
    const fileName = `${docData.type}_${docData.patientName.replace(/\s+/g, '_')}_${docData.date}.pdf`;
    doc.save(fileName);
    showToast('üìÑ PDF gerado com sucesso!');
}

// Fun√ß√£o auxiliar para formatar labels
function formatLabel(key) {
    return key
        .replace(/-/g, ' ')
        .replace(/_/g, ' ')
        .replace(/([A-Z])/g, ' $1')
        .replace(/^./, str => str.toUpperCase())
        .trim();
}

// VISUALIZAR DOCUMENTO
function viewDocument(docId) {
    showLoading(true);
    
    database.ref('documents/' + currentUser.cpf + '/' + docId).once('value')
        .then(snapshot => {
            showLoading(false);
            if (snapshot.exists()) {
                const doc = snapshot.val();
                currentViewDoc = doc;
                
                document.getElementById('viewModalTitle').textContent = doc.docName || doc.type;
                
                let content = `
                    <div class="form-card">
                        <p><strong>Paciente:</strong> ${doc.patientName}</p>
                        <p><strong>Data:</strong> ${new Date(doc.date).toLocaleDateString('pt-BR')}</p>
                        <p><strong>Profissional:</strong> ${doc.professional} - ${doc.registro}</p>
                        ${doc.location ? `<p><strong>Local:</strong> ${doc.location}</p>` : ''}
                    </div>
                `;
                
                if (doc.formData) {
                    content += '<div class="form-card">';
                    Object.entries(doc.formData).forEach(([key, value]) => {
                        if (value) {
                            const label = formatLabel(key);
                            content += `<p><strong>${label}:</strong> ${value}</p>`;
                        }
                    });
                    content += '</div>';
                }
                
                document.getElementById('viewModalBody').innerHTML = content;
                document.getElementById('viewModal').style.display = 'flex';
            }
        });
}

function closeViewModal() {
    document.getElementById('viewModal').style.display = 'none';
    currentViewDoc = null;
}

function generatePDFSingle(docId) {
    showLoading(true);
    database.ref('documents/' + currentUser.cpf + '/' + docId).once('value')
        .then(snapshot => {
            showLoading(false);
            if (snapshot.exists()) {
                generatePDF(snapshot.val());
            }
        });
}

function generatePDFFromView() {
    if (currentViewDoc) {
        generatePDF(currentViewDoc);
    }
}

// HIST√ìRICO GERAL
function loadAllDocuments() {
    const container = document.getElementById('allDocumentsList');
    if (!container) return;
    
    container.innerHTML = '<p style="text-align:center;color:#666;padding:20px;">Carregando...</p>';
    
    database.ref('documents/' + currentUser.cpf).orderByChild('createdAt').limitToLast(50).once('value')
        .then(snapshot => {
            container.innerHTML = '';
            
            if (!snapshot.exists()) {
                container.innerHTML = '<p style="text-align:center;color:#666;padding:20px;">Nenhum documento gerado</p>';
                return;
            }
            
            const docs = [];
            snapshot.forEach(child => {
                const doc = child.val();
                doc.id = child.key;
                docs.push(doc);
            });
            
            docs.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            docs.forEach(doc => {
                const div = document.createElement('div');
                div.className = 'form-card';
                div.style.cursor = 'pointer';
                div.onclick = () => viewDocument(doc.id);
                
                const docDate = new Date(doc.date).toLocaleDateString('pt-BR');
                
                div.innerHTML = `
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <div>
                            <h4 style="color:var(--azul-marinho);">${doc.docName || doc.type}</h4>
                            <p style="color:#666;font-size:0.85rem;">${doc.patientName} ‚Ä¢ ${docDate}</p>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-info" onclick="event.stopPropagation();viewDocument('${doc.id}')" style="margin-right:5px;">üëÅ</button>
                            <button class="btn btn-sm btn-danger" onclick="event.stopPropagation();generatePDFSingle('${doc.id}')">üìÑ</button>
                        </div>
                    </div>
                `;
                
                container.appendChild(div);
            });
        });
}

// EXPORTAR PRONTU√ÅRIO COMPLETO
function exportProntuarioPDF() {
    if (!currentPatientData) return;
    
    showLoading(true);
    
    database.ref('documents/' + currentUser.cpf).orderByChild('patientId').equalTo(currentPatientId).once('value')
        .then(snapshot => {
            showLoading(false);
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Cabe√ßalho profissional
            const clinicaNome = userConfig.clinica || currentUser.clinica || 'ASM DOCS Pro';
            
            doc.setFillColor(30, 58, 95);
            doc.rect(0, 0, 210, 40, 'F');
            doc.setTextColor(201, 162, 39);
            doc.setFontSize(16);
            doc.text(clinicaNome.toUpperCase(), 105, 12, { align: 'center' });
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.text('PRONTU√ÅRIO DO PACIENTE', 105, 22, { align: 'center' });
            doc.setFontSize(10);
            doc.text(`${currentUser.name} - ${currentProfession.registro}: ${currentUser.registro}`, 105, 32, { align: 'center' });
            
            // Dados do paciente
            let y = 50;
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            
            doc.setFont('helvetica', 'bold');
            doc.text('DADOS DO PACIENTE', 20, y);
            y += 10;
            
            doc.setFont('helvetica', 'normal');
            doc.text(`Nome: ${currentPatientData.name}`, 20, y);
            y += 7;
            
            if (currentPatientData.birth) {
                doc.text(`Data de Nascimento: ${new Date(currentPatientData.birth).toLocaleDateString('pt-BR')}`, 20, y);
                y += 7;
            }
            
            if (currentPatientData.cpf) {
                const cpfFormatted = currentPatientData.cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
                doc.text(`CPF: ${cpfFormatted}`, 20, y);
                y += 7;
            }
            
            if (currentPatientData.phone) {
                doc.text(`Telefone: ${currentPatientData.phone}`, 20, y);
                y += 7;
            }
            
            y += 10;
            
            // Documentos
            if (snapshot.exists()) {
                doc.setFont('helvetica', 'bold');
                doc.text('HIST√ìRICO DE DOCUMENTOS', 20, y);
                y += 10;
                
                const docs = [];
                snapshot.forEach(child => {
                    docs.push(child.val());
                });
                
                docs.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
                
                docs.forEach((docItem, index) => {
                    if (y > 250) {
                        doc.addPage();
                        y = 20;
                    }
                    
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(10);
                    doc.text(`${index + 1}. ${docItem.docName || docItem.type}`, 20, y);
                    y += 5;
                    
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(9);
                    doc.text(`Data: ${new Date(docItem.date).toLocaleDateString('pt-BR')} | Profissional: ${docItem.professional}`, 20, y);
                    y += 5;
                    
                    if (docItem.formData) {
                        Object.entries(docItem.formData).slice(0, 3).forEach(([key, value]) => {
                            if (value && y < 280) {
                                const text = `${formatLabel(key)}: ${String(value).substring(0, 50)}${String(value).length > 50 ? '...' : ''}`;
                                doc.text(text, 25, y);
                                y += 4;
                            }
                        });
                    }
                    
                    y += 5;
                });
            } else {
                doc.text('Nenhum documento encontrado.', 20, y);
            }
            
            // Rodap√©
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 280, 210, 20, 'F');
                doc.setFontSize(8);
                doc.setTextColor(201, 162, 39);
                doc.text(`Prontu√°rio gerado em ${new Date().toLocaleDateString('pt-BR')} - P√°gina ${i} de ${pageCount}`, 105, 288, { align: 'center' });
                doc.setTextColor(255, 255, 255);
                doc.text('¬© Dra. Andresa Augusto - Proibida reprodu√ß√£o sem autoriza√ß√£o', 105, 295, { align: 'center' });
            }
            
            const fileName = `Prontuario_${currentPatientData.name.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
        });
}

// CONTATO WHATSAPP
function contactPatient() {
    if (!currentPatientData || !currentPatientData.phone) {
        showToast('Paciente n√£o tem telefone cadastrado!');
        return;
    }
    
    const phone = currentPatientData.phone.replace(/\D/g, '');
    const message = `Ol√° ${currentPatientData.name}! Sou ${currentUser.name}, gostaria de confirmar nosso atendimento.`;
    window.open(`https://wa.me/55${phone}?text=${encodeURIComponent(message)}`, '_blank');
}

function sendWhatsAppFromView() {
    if (currentViewDoc && currentViewDoc.patientId) {
        database.ref('patients/' + currentUser.cpf + '/' + currentViewDoc.patientId).once('value')
            .then(snapshot => {
                if (snapshot.exists()) {
                    const patient = snapshot.val();
                    if (patient.phone) {
                        const phone = patient.phone.replace(/\D/g, '');
                        window.open(`https://wa.me/55${phone}`, '_blank');
                    } else {
                        showToast('Paciente n√£o tem telefone cadastrado!');
                    }
                }
            });
    }
}

// UTILIT√ÅRIOS
function showLoading(show) {
    document.getElementById('loading').style.display = show ? 'block' : 'none';
}

function showToast(mensagem) {
    const toast = document.getElementById('toast');
    toast.textContent = mensagem;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3000);
}

function closeDocumentModal() {
    document.getElementById('documentModal').style.display = 'none';
    assinaturas = {};
}

function openNewDocumentForPatient() {
    if (currentPatientId) {
        showSection('documents');
        document.getElementById('docPatientSelect').value = currentPatientId;
        updatePatientForDoc();
        closeProntuario();
    }
}
</script>
</body>
</html>
